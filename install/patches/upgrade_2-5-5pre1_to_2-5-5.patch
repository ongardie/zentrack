diff -x install/ -Nur zentrack_2-5-5_pre1/CHANGELOG zentrack_2-5-5/CHANGELOG
--- zentrack_2-5-5_pre1/CHANGELOG	2005-03-11 07:47:06.000000000 -0800
+++ zentrack_2-5-5/CHANGELOG	2005-05-02 00:05:52.000000000 -0700
@@ -11,7 +11,147 @@
 abstraction, and endless possibilities for project expansion. 
 --------------------
 
------ VERSION 2.5.0.3 (development) -----
+----- VERSION 2.5.6 (development) -----
+
+
+
+----- VERSION 2.5.5 (2005-05-02) -----
+
+2005-04-27, kato
+  Added security to includes/ files to provide security for users who
+  do not correctly locate the includes/ files outside of the web tree.
+    - all include files
+  Added the ability to add non-standard fields such as wkd_hours to the create
+  and edit screens.
+    - zentrack_2/includes/zen.class 1.36
+    - zentrack_2/includes/parseVarfields.php 1.4
+    - zentrack_2/includes/validateFields.php 1.1
+    - zentrack_2/www/addProjectSubmit.php 1.19
+    - zentrack_2/www/addSubmit.php 1.25
+    - zentrack_2/www/admin/editTicketSubmit.php 1.5
+  Improved header/footer comments and messages
+    - zentrack_2/includes/footer.php 1.34
+    - zentrack_2/install/header.php.default 1.17
+
+2005-04-20, kato
+  Improved performance for ticket queries retrieved by contact
+  Fixed minor bugs in retrieving list of tickets by contact (person or company)
+  Added field map information to the contacts page (for listing tickets properly)
+    - zentrack_2/includes/zenTrack.class 1.182
+    - zentrack_2/www/contact.php 1.3
+    - zentrack_2/includes/db.class 1.39
+    - zentrack_2/www/contact.php 1.3
+  Improved sorting algorithm to insure that columns to sort doesn't exceed 2
+  (for efficieny)
+    - zentrack_2/includes/sorting.php 1.4
+  Added email test to install utils.
+    - zentrack_2/install/utils/send_email_test.php 1.0
+  Added improved array merge util
+    - zentrack_2/includes/zen.class 1.35
+
+2005-04-19, kato
+  Corrected build_postgres.sql syntax error (extra comma)
+  Corrected oracle insert problems with zentrack_group_detail (invalid field name)
+    - zentrack_2/install/build_postgres.sql 1.19
+    - zentrack_2/install/build_oracle.sql 1.19
+    - zentrack_2/install/UPGRADE_postgres.sql 1.35
+    - zentrack-2/install/UPGRADE_oracle.sql 1.43
+
+2005-04-12, kato
+  Added support for 'mysqli' driver and some bug fixes in db insert calls
+    - zentrack_2/includes/db.class 1.37
+    - zentrack_2/includes/zen.class 1.34
+  Cleaned up security restrictions
+    - zentrack_2/includes/session_start.php 1.24
+  Fixed arrow images in admin field map form, which were broken when rootUrl
+  is not /.
+    - zentrack_2/includes/templates/fieldMapForm.php 1.9
+  Added some useful security into the debug information (protect passwords,
+  emails, and urls).
+    - zentrack_2/includes/footer.php 1.32
+  Fixed project submit bug (type_id required, system_id required, etc..)
+    - zentrack_2/www/addProjectSubmit.php
+  Cleaned up behavior code for dealing with default values in hidden and text
+  fields
+    - zentrack_2/www/behavior_js.php 1.27
+    
+2005-03-17, kato
+  Added ability to change label text when a behavior is run, so that the label
+  field type can work with behaviors properly.
+    - zentrack_2/includes/templates/fields/label.template
+    - zentrack_2/www/behavior_js.php
+
+2005-04-06, cfalonso
+  Fixed problem in fieldmap admin page for ticket_close map
+    - zentrack_2/includes/templates/fieldMapForm.php 1.8
+  Fixed error raised in JS Console when accessing the ticket's close page
+    - zentrack_2/includes/ZenFieldMap.class 1.14
+  To be used for hidden, text, etc: set the oldPos value if the fieldObj.value is in the list
+  (unless we do it, the first element of the list will always be assigned to the field, no matter if the fieldObj.value is in the list)
+    - zentrack_2/www/behavior_js.php 1.25
+    - zentrack_2/www/behavior_js.php 1.24
+
+2005-03-31, cfalonso
+  Fixed security hole for first login
+    - zentrack_2/includes/leftMain.php 1.6
+    - zentrack_2/www/admin/admin_header.php 1.13
+  Some minor modifications
+    - zentrack_2/includes/ZenFieldMap.class 1.13
+    - zentrack_2/includes/zenTrack.class 1.180
+    - zentrack_2/includes/templates/accessForm.php 1.9
+    - zentrack_2/includes/templates/fields/label.template 1.3
+    - zentrack_2/www/behavior_js.php 1.23
+
+2005-03-22, cfalonso
+  Modified spanich translation
+    - zentrack_2/includes/translations/spanish.trans 1.8
+
+2005-03-21, cfalonso
+  For ticket's mails, included user's email in log
+    - zentrack_2/www/actions/email.php 1.15
+  Fixed a bug with retain_owner_move
+    - zentrack_2/includes/zenTrack.class 1.179
+
+2005-03-18, cfalonso
+  Related tickets weren't shown  -Fixed
+    - zentrack_2/includes/templates/ticket_relatedBox.php 1.6
+  Allow deadline to be a menu dropdown
+    - zentrack_2/includes/ZenFieldMap.class 1.12
+  Translation minor changes
+    - zentrack_2/includes/translations/spanish.trans 1.7
+    - zentrack_2/includes/translations/spanish.trans 1.6
+
+2005-03-15, cfalonso
+  Added the posibility to set ctime when ticket is set to Pending (settings["ctime_on_pending"])
+    - zentrack_2/includes/zenTrack.class 1.178
+    - zentrack_2/includes/templates/ticket_detailsBox.php 1.15
+    - zentrack_2/install/UPGRADE_mssqlserver.sql 1.35
+    - zentrack_2/install/UPGRADE_mysql.sql 1.45
+    - zentrack_2/install/UPGRADE_oracle.sql 1.41
+    - zentrack_2/install/UPGRADE_postgres.sql 1.33
+    - zentrack_2/install/seed_mssqlserver.sql 1.36
+    - zentrack_2/install/seed_mysql.sql 1.49
+    - zentrack_2/install/seed_oracle.sql 1.42
+    - zentrack_2/install/seed_postgres.sql 1.38
+
+  Standard fields don't respect ID in search page when used as menu fields  -Fixed
+    - zentrack_2/includes/ZenFieldMap.class 1.11
+  FieldMap didn't show the current default value as "selected"  -Fixed
+    - zentrack_2/includes/templates/fieldMapForm.php 1.7
+
+2005-03-14, cfalonso
+  Some bugfixes
+    - zentrack_2/includes/zenTemplate.class 1.8
+    - zentrack_2/includes/templates/listTickets.php 1.25
+    - zentrack_2/includes/templates/searchResults.php 1.12
+    - zentrack_2/install/UPGRADE_mssqlserver.sql 1.34
+    - zentrack_2/install/UPGRADE_mysql.sql 1.44
+    - zentrack_2/install/UPGRADE_oracle.sql 1.40
+    - zentrack_2/install/UPGRADE_postgres.sql 1.32
+    - zentrack_2/install/seed_mssqlserver.sql 1.35
+    - zentrack_2/install/seed_mysql.sql 1.48
+    - zentrack_2/install/seed_oracle.sql 1.41
+    - zentrack_2/install/seed_postgres.sql 1.37
 
 2005-03-11, kato
   UI fixed to allow clicking anywhere in nav menus.
diff -x install/ -Nur zentrack_2-5-5_pre1/HELP zentrack_2-5-5/HELP
--- zentrack_2-5-5_pre1/HELP	2005-01-23 20:27:11.000000000 -0800
+++ zentrack_2-5-5/HELP	2005-05-01 23:59:35.000000000 -0700
@@ -9,10 +9,12 @@
     http://docs.zentrack.net
 	
   Troubleshooting:
-        Open includes/configVars.php and set $this->debug = 1,2, or 3;  
-        This will produce highly useful output for debugging.  
-        If you have trouble, send a support request (see below) with 
-        the debug output pasted at the bottom of your message.
+     Insure that you do not use \ characters for directories in your header.php file!
+     
+    Open includes/configVars.php and set $this->debug = 1,2, or 3;  
+    This will produce highly useful output for debugging.  
+    If you have trouble, send a support request (see below) with 
+    the debug output pasted at the bottom of your message.
 
   Support
 
@@ -26,16 +28,52 @@
              the community forums!  http://www.zentrack.net
 
     mailing list - zentrack-users is a great place to get help.  Answers usually
-             within an hour.  http://sourceforge.net/mail/?group_id=22724, never
-             ignored.
+             within an hour.  http://sourceforge.net/mail/?group_id=22724.
 
+  HEADER.PHP MISSING
+    -This is probably a cvs checkout.  Just go to the directory where
+     you unzipped zentrack and run setup_from_cvs (.cmd on windows) to
+     build directories, permissions, and the header.php file.
 
+  LOGIN PROBLEMS
+    -Logins are case sensitive
 
+    -Check your database and insure there are entries in the ZENTRACK_USERS
+     table.
 
+    -The Administrator password is Administrator, User password is User, Guest
+     password is Guest.
 
+    -Sessions have to be working properly, cookies enabled
 
+    -The url you type in your browser must match the domain the server thinks it is, or session may fail.
 
+  REPORT IMAGE PROBLEMS
+    -Broken images
+      You must have GD 2.0 and freetype installed
+      You can view error messages by right clicking on the broken image, and getting the direct url
+      When you browse to this url, you will see the error output (possibly the image binary too)
 
+    -To view debugging output for an image, open www/view_image.php and setting $graph->debug to 1-3.
+      You will probably want to use 1 or 2, 3 is mostly for developers
+      Note that you have to view the image directly to see this (in the page, it just shows a broken image)
 
+    -Problems viewing png images
 
+    You can manually set the image type to "jpeg" if you have
+    trouble with pngs by opening includes/reportConfig.php
+    and finding the line called image_type.
 
+  EMAIL GATEWAY PROBLEMS
+    -Check includes/logs/egate_log for clues
+    
+    -Make sure you have the egate user account set up with proper permissions 
+       (this account doesn't have to be active)
+       
+    -Make sure you turn on email_gateway in the configuration panel.
+
+    -Make sure that you have your egate scripts chmod to 755 (executable)
+
+  OTHER DATABASE USERS
+    -We can support, upon request, DB2, Sybase, or other
+     install scripts, with some assistance from you.
diff -x install/ -Nur zentrack_2-5-5_pre1/INSTALL.README zentrack_2-5-5/INSTALL.README
--- zentrack_2-5-5_pre1/INSTALL.README	2005-02-19 22:55:59.000000000 -0800
+++ zentrack_2-5-5/INSTALL.README	2005-05-01 23:59:35.000000000 -0700
@@ -10,7 +10,7 @@
   REQUIREMENTS
   --------------
     Basic Install
-       PHP >= 4.3 && < 5 (PHP5 will be supported in ZT 2.6)
+       PHP >= 4.3 && < 5 (PHP5 will be supported in version 2.6)
        Mysql, Oracle, Postgres, or SqlServer
        A Basic knowledge of PHP is helpful
     Email Gateway (optional)
@@ -37,7 +37,7 @@
   --------------
      0. CVS Installs:
         - If you did not check this out from CVS (or don't know what that means)
-          then skip this step!  r
+          then skip this step!
         - run ./setup_from_cvs (or setup_from_cvs.cmd)
           from the root directory
 
@@ -86,57 +86,6 @@
   TROUBLESHOOTING
   --------------
 
-    SUPPORT
-      -Check the HELP file in this directory for more info about obtaining support.
+    Check the HELP file in this directory for more info about common errors
+    and for obtaining support.
 
-    HEADER.PHP MISSING
-      -This is probably a cvs checkout.  Just go to the directory where
-       you unzipped zentrack and run setup_from_cvs (.cmd on windows) to
-       build directories, permissions, and the header.php file.
-
-    LOGIN PROBLEMS
-      -Logins are case sensitive
-
-      -Check your database and insure there are entries in the ZENTRACK_USERS
-       table.
-
-      -The Administrator password is Administrator, User password is User, Guest
-       password is Guest.
-
-      -Sessions have to be working properly, cookies enabled
-
-      -The url you type in your browser must match the domain the server thinks it is, or session may fail.
-
-    REPORT IMAGE PROBLEMS
-      -Broken images
-        You must have GD 2.0 and freetype installed
-        You can view error messages by right clicking on the broken image, and getting the direct url
-        When you browse to this url, you will see the error output (possibly the image binary too)
-
-      -To view debugging output for an image, open www/view_image.php and setting $graph->debug to 1-3.
-        You will probably want to use 1 or 2, 3 is mostly for developers
-        Note that you have to view the image directly to see this (in the page, it just shows a broken image)
-
-      -Problems viewing png images
-
-      You can manually set the image type to "jpeg" if you have
-      trouble with pngs by opening includes/reportConfig.php
-      and finding the line called image_type.
-
-    EMAIL GATEWAY PROBLEMS
-      -Check includes/logs/egate_log for clues
-      
-      -Make sure you have the egate user account set up with proper permissions 
-         (this account doesn't have to be active)
-         
-      -Make sure you turn on email_gateway in the configuration panel.
-
-      -Make sure that you have your egate scripts chmod to 755 (executable)
-
-    POSTGRES USERS
-      -Please report any postgres nuisances.  It seems to be running
-       smoothly, but we do have a postgres test box.
-
-    OTHER DATABASE USERS
-      -We can support, upon request, DB2, Sybase, or other
-       install scripts, with some assistance from you.
diff -x install/ -Nur zentrack_2-5-5_pre1/UPGRADE.readme zentrack_2-5-5/UPGRADE.readme
--- zentrack_2-5-5_pre1/UPGRADE.readme	2005-03-11 08:15:53.000000000 -0800
+++ zentrack_2-5-5/UPGRADE.readme	2005-05-01 23:59:35.000000000 -0700
@@ -24,6 +24,16 @@
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 --------------------
+UPGRADE FROM 2.5.5 PRE1 or PRE2
+--------------------
+  
+  1. Delete your ZENTRACK_FIELD_MAP table.
+  2. Run the UPGRADE_yourdb.sql file
+  3. Manually copy the files from the install folder over your existing
+     includes and www directories.  (Remember to back up your header.php
+     file first and to restore it afterwards!)
+  
+--------------------
 UPGRADE FROM 2.5.0.2
 --------------------
   
@@ -31,7 +41,7 @@
   !!! VERY IMPORTANT NOTE !!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!
   
-  As of 2.5.0.3, there are now two ways to upgrade.  There
+  As of 2.5.5, there are now two ways to upgrade.  There
   is a patch and a manual upgrade approach.  Please select
   the method that meets your needs.
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/ZenFieldMap.class zentrack_2-5-5/includes/ZenFieldMap.class
--- zentrack_2-5-5_pre1/includes/ZenFieldMap.class	2005-03-11 07:37:36.000000000 -0800
+++ zentrack_2-5-5/includes/ZenFieldMap.class	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 // define some constants for field types
 define("ZTFIELD_HIDDEN",0);
@@ -250,10 +252,16 @@
   /**
    * Returns the label specified for the field in question
    */
+/*old Function (wrong):
   function getLabel( $view, $field_name ) {
     $field = $this->getFieldFromMap($view,$field_name);
     return $field['field_label']? $field['field_label'] : $field['field_name'];
   }
+  new Function: */
+  function getLabel( $view, $field_name) {
+    $field = $this->getFieldFromMap($view,is_array($field_name)?$field_name['field_name']:$field_name);
+    return $field['field_label']? $field['field_label'] : $field['field_name'];
+  }
   
   /**
    * Consults the field map and returns a string of suitable text to show
@@ -325,7 +333,7 @@
    * @return string containing html to render
    */
   function renderTicketField( $view, $form_name, $field_name, $value = null, $override_name = null ) {
-    //$this->_zen->addDebug("renderTicketField", "rendering $view, $form_name, $field_name, $value, $override_name", 1);//debug
+//    $this->_zen->addDebug("renderTicketField", "rendering $view, $form_name, $field_name, $value, $override_name", 1);//debug
     global $templateDir;
     global $rootUrl;
     
@@ -659,9 +667,8 @@
     $this->_zen->addDebug('_getChoices', "Generated ".count($vals)." choices for {$view}->{$field_name}", 3);
     
     if( $view == 'search_form' && $field['num_rows'] == 1 ) {
-      $vals = array_merge( array(''=>'-any-'), $vals );
+      $vals = array(''=>'-any-') + $vals ;
     }
-    
     if( !isset($this->_fieldVals[$view]) ) { $this->_fieldVals[$view] = array(); }
     $this->_fieldVals[$view][$field_name] = $vals;
     return $vals;
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/ZenSessionManager.class zentrack_2-5-5/includes/ZenSessionManager.class
--- zentrack_2-5-5_pre1/includes/ZenSessionManager.class	2005-02-28 12:02:28.000000000 -0800
+++ zentrack_2-5-5/includes/ZenSessionManager.class	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 /**
  * Manages session information for ZT
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/configVars.php zentrack_2-5-5/includes/configVars.php
--- zentrack_2-5-5_pre1/includes/configVars.php	2005-05-04 06:28:27.490011200 -0700
+++ zentrack_2-5-5/includes/configVars.php	2005-05-03 21:46:58.829126400 -0700
@@ -20,10 +20,10 @@
    global $Db_Instance;
    global $Db_Login;
    global $Db_Pass;
-   
 
    $this->demo_mode = $Demo_Mode; 
-   $this->debug = $Debug_Mode;  
+   $this->debug = $Debug_Mode;
+   //$this->sql_debug = true;  //uncommenting this will break everything and produce tons of garbage
    
    $this->database_type      = $Db_Type;
    $this->database_instance  = $Db_Instance;
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/db.class zentrack_2-5-5/includes/db.class
--- zentrack_2-5-5_pre1/includes/db.class	2005-02-19 22:55:59.000000000 -0800
+++ zentrack_2-5-5/includes/db.class	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 include_once("$libDir/adodb/adodb.inc.php");
 
@@ -146,7 +148,7 @@
     // .. in mysql, there is no SELECT nextval()
     // so it is easieast to run the query, then return
     // the mysql function mysql_insert_id()
-    if( $this->database_type != 'mysql' ) {
+    if( !Zen::inString('mysql',$this->database_type) ) {
       if( !$sequence ) {
         $sequence = ereg_replace("zentrack_", "", strtolower($table));
         $sequence .= "_id_seq";
@@ -184,7 +186,7 @@
         $res = $this->db_link->Execute($query);
       }
     }
-    if( $res && $this->database_type == "mysql" ) {
+    if( $res && Zen::inString('mysql',$this->database_type) ) {
       $id = $this->db_insertID();
     }
     if( $res ) {
@@ -211,15 +213,16 @@
     $this->switchQueryMode(0);
     $recordSet = &$this->db_link->Execute($query);
     $this->addDebug('db_list','['.$recordSet.'] '.$query,3);
+    $vals = array();
     if( $recordSet ) {
       $vars = $recordSet->getArray();
       if( is_array($vars) && count($vars) > 0 ) {
         foreach($vars as $v) {
           $vals[] = $v[0];
         }
-        return($vals);
       }
     }
+    return($vals);
   }
   
   function db_listIndexed( $query ) {
@@ -252,7 +255,10 @@
     // insert id for the INSERT statement about to take place... don't
     // forget to manually add the id with the insert statement in 
     // this case!
-    if( $this->database_type == 'mysql' ) {
+    if( $this->database_type == 'mysqli' ) {
+      $id = mysqli_insert_id();
+    }
+    else if( Zen::inString('mysql',$this->database_type) ) {
       $id = mysql_insert_id();
     } else {
       $id = $this->db_link->genID($sequence);
@@ -476,8 +482,8 @@
         }
         $p[2] = $this->checkSlashes($p[2]);
         if( !$p[3] && ereg("[a-zA-Z]",$p[2]) ) {
-          if( !Zen::inString('mysql',$this->db_type) 
-            && !Zen::inString('mssql',$this->db_type) ) {
+          if( !Zen::inString('mysql',$this->database_type) 
+            && !Zen::inString('mssql',$this->database_type) ) {
             $p[0] = "lower($p[0])";
             $p[2] = strtolower($p[2]);
           }
@@ -507,6 +513,13 @@
     if( $database and $this->db_link ) {
       $this->dbName = $database;
     }
+    
+    if( $this->db_link ) {
+      $this->addDebug('db_connect', "Connected successfully to database", 3);
+    }
+    else {
+      $this->addDebug('db_connect', "Could not connect to $user@$host:$database", 1);
+    }
     return( $this->db_link );      
   }
   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/editAgreementSubmit.php zentrack_2-5-5/includes/editAgreementSubmit.php
--- zentrack_2-5-5_pre1/includes/editAgreementSubmit.php	2004-09-03 08:41:48.000000000 -0700
+++ zentrack_2-5-5/includes/editAgreementSubmit.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 
   // initiate default values
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/editContactSubmit.php zentrack_2-5-5/includes/editContactSubmit.php
--- zentrack_2-5-5_pre1/includes/editContactSubmit.php	2004-09-08 01:22:37.000000000 -0700
+++ zentrack_2-5-5/includes/editContactSubmit.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 
   // initiate default values
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/editContacteSubmit.php zentrack_2-5-5/includes/editContacteSubmit.php
--- zentrack_2-5-5_pre1/includes/editContacteSubmit.php	2004-09-08 01:22:37.000000000 -0700
+++ zentrack_2-5-5/includes/editContacteSubmit.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 
   // initiate default values
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/editCustomSubmit.php zentrack_2-5-5/includes/editCustomSubmit.php
--- zentrack_2-5-5_pre1/includes/editCustomSubmit.php	2005-02-09 05:56:12.000000000 -0800
+++ zentrack_2-5-5/includes/editCustomSubmit.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,23 +1,20 @@
 <?
-//if( !$zen->checkAccess($login_id,$ticket["bin_id"],"edit_custom") ) {
-//  $errs[] = tr("You cannot edit a ticket's custom fields in this bin ");
-//} else if( !$zen->actionApplicable($id,"edit_custom",$login_id) ) {
-//  $errs[] = $zen->ptrans("Ticket #? cannot be edited in its current status",array($id));
-//}
+  if( !ZT_DEFINED ) { die("Illegal Access"); }
+  
   $page_title = tr("Ticket #?: Save Custom Fields", array($id));
   $fields = array();
   $required = array();
   // the TODO is saved, even if the save failed
   $TODO = 'SAVED';
                                 
-  if( !$errs ) {
-    $customFieldsArray = $zen->getCustomFields(0,$page_type, 'Custom Tab');
-    include("$libDir/parseVarfields.php");
-  }
+  include("$libDir/validateFields.php");
 
   if( !$errs ) {
-    // update the ticket info
-    $res = $zen->updateVarfieldVals($id,$varfield_params);
+    if( count($varfield_params) ) {
+      // update the ticket info
+      $res = $zen->updateVarfieldVals($id,$varfield_params);
+    }
+
     // check for errors
     if( !$res ) {
       $errs[] = tr("System Error").": ".tr("Ticket could not be edited.")." ".$zen->db_error;
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/editTicketSubmit.php zentrack_2-5-5/includes/editTicketSubmit.php
--- zentrack_2-5-5_pre1/includes/editTicketSubmit.php	2005-03-01 07:32:25.000000000 -0800
+++ zentrack_2-5-5/includes/editTicketSubmit.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,5 +1,6 @@
 <?
-
+  if( !ZT_DEFINED ) { die("Illegal Access"); }
+  
   if( !$zen->checkAccess($login_id,$ticket["bin_id"],"edit") ) {
     $errs[] = tr("You cannot edit a ticket in this bin ");
   } else if( !$zen->actionApplicable($id,"edit",$login_id) ) {
@@ -20,53 +21,14 @@
      $tested = 0;
   if( !$approved )
      $approved = 0;
-  if( $type == "project" && !$type_id )
+  if( $type == "project" )
      $type_id = $zen->projectTypeID();
 
   $is_project = $type == 'project' || $zen->inProjectTypeIds($type_id);
+  $view = $is_project? 'project_edit' : 'ticket_edit';
 
-  $fields = array(
-        "title"       => "text",
-        "priority"    => "int",
-        "description" => "html",
-        "bin_id"       => "int",
-        "type_id"      => "int",
-        "user_id"      => "int",
-        "system_id"    => "int",
-        "tested"      => "int",
-        "approved"    => "int",
-        "relations"   => "text",
-        "project_id"   => "int",
-        "est_hours"   => "num",
-        "deadline"    => "int",
-        "start_date"  => "int"
-        );
- // $required = array(
-         // "title",
-         // "priority",
-         // "description",
-         // "bin_id",
-         // "type_id",
-         // "system_id"
-         // );
-
-  $customFieldsArray = false;
-  $customFieldsArray = $map->getFieldMap($type=='project'?'project_edit':'ticket_edit');
-
-  $required = array();
-  foreach($customFieldsArray as $f=>$field) {
-    if( $field['is_required'] ) {
-      $required[] = $f;
-    }
-  }
-         
-  $zen->cleanInput($fields);
-  // check for required fields
-  foreach($required as $r) {
-     if( !$$r ) {
-   $errs[] = ucfirst($r)." ".tr("is a required field");
-     }
-  }
+  include("$libDir/validateFields.php");
+  
   if( !$errs ) {
      $params = array();
      // create an array of existing fields
@@ -79,23 +41,7 @@
      if( !$res ) {
        $errs[] = tr("System Error").": ".tr("Ticket could not be edited.")." ".$zen->db_error;
      }
-     else {
-       // parse variable fields which appear in new ticket screen, 
-       // store them in $varfield_params
-       // insure that all requirements are met before proceeding
-       // with the ticket save process
-       if( !$errs ) {
-         foreach(array_keys($customFieldsArray) as $f) {
-           if (strncmp($f,"custom_",7)!=0) {
-             unset($customFieldsArray["$f"]);
-           }
-         }
-         if( $customFieldsArray && count($customFieldsArray) ) {
-           include("$libDir/parseVarfields.php");
-         }
-       }
-       
-       if( $customFieldsArray && count($varfield_params) ) {
+     else if( $varfields && count($varfield_params) ) {
          $res = $zen->updateVarfieldVals($id, $varfield_params, $login_id, $bin_id);
          if( !$res ) {
            $errs[] = tr("? updated, but variable fields could not be saved", array(tr($x)));
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/egate.php zentrack_2-5-5/includes/egate.php
--- zentrack_2-5-5_pre1/includes/egate.php	2004-08-10 07:27:41.000000000 -0700
+++ zentrack_2-5-5/includes/egate.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 #!/usr/bin/php -q
 <?{
   /*
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/egate_check.php zentrack_2-5-5/includes/egate_check.php
--- zentrack_2-5-5_pre1/includes/egate_check.php	2003-03-12 00:53:20.000000000 -0800
+++ zentrack_2-5-5/includes/egate_check.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 #!/usr/bin/php -q
 <?
 /**
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/egate_check_create.php zentrack_2-5-5/includes/egate_check_create.php
--- zentrack_2-5-5_pre1/includes/egate_check_create.php	2003-04-15 00:29:54.000000000 -0700
+++ zentrack_2-5-5/includes/egate_check_create.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 #!/usr/bin/php -q
 <?
 /**
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/egate_create.php zentrack_2-5-5/includes/egate_create.php
--- zentrack_2-5-5_pre1/includes/egate_create.php	2003-04-15 00:29:54.000000000 -0700
+++ zentrack_2-5-5/includes/egate_create.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 #!/usr/bin/php -q
 <?{
   /*
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/egate_utils.php zentrack_2-5-5/includes/egate_utils.php
--- zentrack_2-5-5_pre1/includes/egate_utils.php	2005-01-31 08:04:56.000000000 -0800
+++ zentrack_2-5-5/includes/egate_utils.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /*
   **  EGATE UTILS
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/footer.php zentrack_2-5-5/includes/footer.php
--- zentrack_2-5-5_pre1/includes/footer.php	2005-02-28 12:02:28.000000000 -0800
+++ zentrack_2-5-5/includes/footer.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
    
 
@@ -48,22 +49,25 @@
   
      $debug_text .= "<tr><td class='mainContent'>\n";
      $debug_text .= "<p><b>SETTINGS / SYSTEM INFO</b></p>\n";
+     if( preg_match('@'.strtolower(Zen::cleanPath($_SERVER['DOCUMENT_ROOT'])).'@', strtolower(Zen::cleanPath($libDir))) ) {
+       $debug_text .= "<b><span class='error'>\$libDir should not be a www viewable directory!</span></b><br>\n";
+     }
      $debug_text .= "<span class='note'>\n";
      $debug_text .= "HTTP_USER_AGENT: $HTTP_USER_AGENT<br>\n";
      $debug_text .= "SCRIPT_NAME: $SCRIPT_NAME<br>\n";
-     $debug_text .= "HTTP_HOST: $HTTP_HOST<br>\n";
+     $debug_text .= "HTTP_HOST: (".(preg_match("/$HTTP_HOST/",$rootUrl)? 'matches rootUrl' : 
+        '<b><span class="error">DOES NOT MATCH $rootUrl!!!</span></b>').")<br>\n";
      $debug_text .= "HTTP_COOKIE: $HTTP_COOKIE<br>\n";
      $debug_text .= "SERVER_SOFTWARE: {$_SERVER['SERVER_SOFTWARE']}<br>\n";
-     $debug_text .= "SERVER_NAME: $SERVER_NAME<br>\n";
      $debug_text .= "PHP Version: ".phpversion()."<br>\n";
      $debug_text .= "zenTrack Version: ".$zen->settings["version_xx"]."<br>\n";
      $debug_text .= "rootUrl: $rootUrl<br>\n";
      $debug_text .= "database: ".$zen->database_type."/".$zen->database_host."<br>\n";
      $debug_text .= "settings count: ".count($zen->settings)."<br>\n";
-     $debug_text .= "bins: ".join(",",$zen->bins)."<br>\n";
-     $debug_text .= "types: ".join(",",$zen->types)."<br>\n";
-     $debug_text .= "priorities: ".join(",",$zen->priorities)."<br>\n";
-     $debug_text .= "systems: ".join(",",$zen->systems)."<br>\n";
+     $debug_text .= "bins: ".(count($zen->bins)? join(",",$zen->bins) : 'NO BINS FOUND, DID YOU RUN THE SEED_YOURDB.SQL SCRIPT?')."<br>\n";
+     $debug_text .= "types: ".(count($zen->types)? join(",",$zen->types) : 'NO TYPES FOUND, DID YOU RUN THE SEED_YOURDB.SQL SCRIPT?')."<br>\n";
+     $debug_text .= "priorities: ".(count($zen->priorities)? join(",",$zen->priorities) : 'NO PRIORITIES FOUND, DID YOU RUN THE SEED_YOURDB.SQL SCRIPT?')."<br>\n";
+     $debug_text .= "systems: ".(count($zen->systems)? join(",",$zen->systems) : 'NO SYSTEMS FOUND, DID YOU RUN THE SEED_YOURDB.SQL SCRIPT?')."<br>\n";
      $debug_text .= "login_language: $login_language<br>\n";
      if( $login_id ) {
        $debug_text .= "login_id: $login_id<br>\n";
@@ -90,21 +94,29 @@
 
      $user = $zen->getUser($login_id);
     ?>
-    <table cellspacing='2' cellpadding='4' width='500' align='center'><tr><td class='mainContent'>
+    <table cellspacing='2' cellpadding='4' width='500' align='center'>
+    <tr><td class='mainContent' align='center'><b>DEBUG LOG</b></td></tr>
+    <tr><td class='mainContent'>
+    <p class='error'>To disable this output, set $Debug_Mode in header.php to 0.  Never leave this on in a production environment!</p>
     <form action='<?=$rootUrl?>/help/bugs.php' method='post'>
-    <input type='submit' value='Report A Bug' name='reportButton' class='submit'>
+    Report bugs by clicking here: <input type='submit' value='Report A Bug' name='reportButton' class='submit'>
     <input type='hidden' name='name' value='<?=$zen->ffv($login_name)?>'>
     <input type='hidden' name='email' value='<?=$zen->ffv($user['email'])?>'>
     <input type='hidden' name='debug_output' value='<?=urlencode($debug_text)?>'>
     <input type='hidden' name='user_info' value='<?=$zen->ffv($_SERVER['HTTP_USER_AGENT'])?>'>
     </form>
     <p>Please send us <a href='http://www.zentrack.net/feedback/?name=<?=$zen->ffv($login_name)?>&email=<?=$user['email']?>&subject=Feedback'>Feedback</a>!</p>
-    <p><b>PHPINFO:</b> <a href='<?=$rootUrl?>/phpinfo.php'>click here to view phpinfo</a></p>
-    <p><b>CACHE:</b> <a href='<?=$SCRIPT_NAME?>?clear_session_cache=1'>click here to clear session cache</a></p>
-    <p><i>To disable this output, set $Debug_Mode in header.php to 0.</i><br>
+    <p><a href='<?=$rootUrl?>/phpinfo.php'>click here to view phpinfo</a></p>
+    <p><a href='<?=$SCRIPT_NAME?>?clear_session_cache=1'>click here to clear session cache</a></p>
     </td></tr>
     <?
-  
+    // for extra security, make sure we don't pass anything sensitive out to
+    // the public
+    $debug_text = preg_replace('/password=[^"\' ]+/', 'password=xxxx', $debug_text);
+    $debug_text = preg_replace('/Db_Pass=[^"\' ]+/', 'Db_Pass=xxxx', $debug_text);
+    $debug_text = preg_replace('/database_password=[^"\' ]+/', 'database_password=xxxx', $debug_text);
+    $debug_text = preg_replace('/[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+[.][a-zA-Z0-9_.-]+/', 'xxxx@xxxx.xxx',$debug_text);
+    $debug_text = preg_replace('@(https?://|www[.])[a-zA-Z0-9_-]+[.]([a-zA-Z]{2,4})@', '\\1xxxx.\\2', $debug_text);
     print $debug_text;
     
     // used by behavior_js.php
@@ -115,6 +127,9 @@
     <?
   }
   
+  //Zen::printArray($_SERVER,'_SERVER');
+  //Zen::printArray($_ENV,'_ENV');
+  
   //if( is_array($ticket) ) {
   //  Zen::printArray($ticket, "Ticket Contents");
   //}
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/headerInc.php zentrack_2-5-5/includes/headerInc.php
--- zentrack_2-5-5_pre1/includes/headerInc.php	2005-03-11 07:37:36.000000000 -0800
+++ zentrack_2-5-5/includes/headerInc.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /*
   ** headerInc.php
   **
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftAdmin.php zentrack_2-5-5/includes/leftAdmin.php
--- zentrack_2-5-5_pre1/includes/leftAdmin.php	2004-09-27 22:24:15.000000000 -0700
+++ zentrack_2-5-5/includes/leftAdmin.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td <?=($expand_admin)? " class='titleCell'" : $nav_rollover_text?>>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftBins.php zentrack_2-5-5/includes/leftBins.php
--- zentrack_2-5-5_pre1/includes/leftBins.php	2004-09-27 22:24:15.000000000 -0700
+++ zentrack_2-5-5/includes/leftBins.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td class="altCell" align=center>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftContacts.php zentrack_2-5-5/includes/leftContacts.php
--- zentrack_2-5-5_pre1/includes/leftContacts.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/leftContacts.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td<?=(isset($expand_contacts)&&$expand_contacts)? " class='titleCell'" : " ".$nav_rollover_text?>>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftHelp.php zentrack_2-5-5/includes/leftHelp.php
--- zentrack_2-5-5_pre1/includes/leftHelp.php	2004-09-27 22:24:15.000000000 -0700
+++ zentrack_2-5-5/includes/leftHelp.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td <?=((isset($expand_help)&&$expand_help))? " class='titleCell'" : $nav_rollover_text?>>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftMain.php zentrack_2-5-5/includes/leftMain.php
--- zentrack_2-5-5_pre1/includes/leftMain.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/leftMain.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <div class="small" align="center"><b><?=$zen->showLongDate()?></b></div>
 <div class="small" align='center'><?=tr("version")?> <?=$zen->settings["version_xx"]?></div>
   
@@ -76,12 +77,13 @@
   </td>
   </tr>  
   <? 
-     if( $login_level >= $zen->settings["level_reports"] ) {
+//we check also if login_level is a number because in first login it will be 'first_login' what would give access to all.
+     if( $zen->checkNum($login_level) >= $zen->settings["level_reports"] ) {
    include("$libDir/leftReports.php");
       } 
   ?>
   <? 
-     if( $login_level >= $zen->settings["level_settings"] ) {
+     if( $zen->checkNum($login_level) >= $zen->settings["level_settings"] ) {
    include("$libDir/leftAdmin.php");
       } 
   ?>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftReports.php zentrack_2-5-5/includes/leftReports.php
--- zentrack_2-5-5_pre1/includes/leftReports.php	2003-03-21 00:27:14.000000000 -0800
+++ zentrack_2-5-5/includes/leftReports.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td <?=($expand_reports)? " class='titleCell'" : $nav_rollover_text?>>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftSearch.php zentrack_2-5-5/includes/leftSearch.php
--- zentrack_2-5-5_pre1/includes/leftSearch.php	2003-03-21 00:27:14.000000000 -0800
+++ zentrack_2-5-5/includes/leftSearch.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td<?=(isset($expand_search)&&$expand_search)? " class='titleCell'" : " ".$nav_rollover_text?>>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/leftTickets.php zentrack_2-5-5/includes/leftTickets.php
--- zentrack_2-5-5_pre1/includes/leftTickets.php	2003-03-21 00:27:14.000000000 -0800
+++ zentrack_2-5-5/includes/leftTickets.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <tr>
   <td<?=(isset($expand_projects)&&$expand_projects)? " class='titleCell'" : " ".$nav_rollover_text?>>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/login.php zentrack_2-5-5/includes/login.php
--- zentrack_2-5-5_pre1/includes/login.php	2004-09-09 17:04:57.000000000 -0700
+++ zentrack_2-5-5/includes/login.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   
   // log user out of zentrack if $logoff
   if( isset($logoff) && $logoff > 0 ) {
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/nav.php zentrack_2-5-5/includes/nav.php
--- zentrack_2-5-5_pre1/includes/nav.php	2004-09-08 01:22:37.000000000 -0700
+++ zentrack_2-5-5/includes/nav.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <html>
   <head>
   <title><?=$page_prefix.$page_title?></title>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/paging.php zentrack_2-5-5/includes/paging.php
--- zentrack_2-5-5_pre1/includes/paging.php	2004-09-09 17:04:57.000000000 -0700
+++ zentrack_2-5-5/includes/paging.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <!--- BEGIN Paging --->
 
 <table width='100%'>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/parseVarfields.php zentrack_2-5-5/includes/parseVarfields.php
--- zentrack_2-5-5_pre1/includes/parseVarfields.php	2004-09-08 01:22:37.000000000 -0700
+++ zentrack_2-5-5/includes/parseVarfields.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,14 +1,16 @@
 <?{
+  if( !ZT_DEFINED ) { die("Illegal Access"); }
+  
   /**
   * Parses form input and creates an array called $varfield_params which contains the values needed
   * to run $zen->updateVarfieldVals()
   *
   * Depends on the following variables to determine which custom fields are used:
-  *   $customFieldsArray - the results of $zen->getCustomFields() call
+  *   $varfields - the results of $zen->getCustomFields() call
   */
   
   $varfield_fields = array();
-  foreach($customFieldsArray as $f) {
+  foreach($varfields as $f) {
     $k = $f['field_name'];
     $v = $f['field_label'];
     $r = $f['is_required'];
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/prepareSearchVarfields.php zentrack_2-5-5/includes/prepareSearchVarfields.php
--- zentrack_2-5-5_pre1/includes/prepareSearchVarfields.php	2004-08-25 09:27:32.000000000 -0700
+++ zentrack_2-5-5/includes/prepareSearchVarfields.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
  $varfieldsAll = $zen->getCustomFields(0,"","Search Screen");
  $varfieldsText = array();
  $varfieldsDates = array();
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/priorityColors.php zentrack_2-5-5/includes/priorityColors.php
--- zentrack_2-5-5_pre1/includes/priorityColors.php	2003-05-06 23:04:08.000000000 -0700
+++ zentrack_2-5-5/includes/priorityColors.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 function color_scale($startcol, $endcol, $pct) {
    // This function returns an HTML colour scaled on a percentile
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/reportConfig.php zentrack_2-5-5/includes/reportConfig.php
--- zentrack_2-5-5_pre1/includes/reportConfig.php	2003-03-28 12:42:28.000000000 -0800
+++ zentrack_2-5-5/includes/reportConfig.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /*
   **  ZENGRAPH CONFIGURATION SETTINGS
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/reportDataParser.php zentrack_2-5-5/includes/reportDataParser.php
--- zentrack_2-5-5_pre1/includes/reportDataParser.php	2004-11-22 01:24:22.000000000 -0800
+++ zentrack_2-5-5/includes/reportDataParser.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 $title_length = 25;
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/session_save.php zentrack_2-5-5/includes/session_save.php
--- zentrack_2-5-5_pre1/includes/session_save.php	2004-07-22 07:00:50.000000000 -0700
+++ zentrack_2-5-5/includes/session_save.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /*
   ** Returns variables extracted to the $_SESSION array
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/session_start.php zentrack_2-5-5/includes/session_start.php
--- zentrack_2-5-5_pre1/includes/session_start.php	2005-01-30 23:05:45.000000000 -0800
+++ zentrack_2-5-5/includes/session_start.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /*
   **  SESSION TRACKING AND MANAGEMENT
@@ -18,7 +20,7 @@
 }
 
 // ... except the following list
-$reservedList = array("libDir", "rootUrl", 
+$reservedList = array("libDir", "rootUrl", "rootWWW",
 		      "Db_Type", "Db_Instance", "Db_Login", "Db_Pass", "Db_Host", 
 		      "Debug_Mode", "Demo_Mode", "Debug_Overview", 
 		      "page_prefix", "page_title", "page_section", 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/smtp.class zentrack_2-5-5/includes/smtp.class
--- zentrack_2-5-5_pre1/includes/smtp.class	2002-05-21 07:32:23.000000000 -0700
+++ zentrack_2-5-5/includes/smtp.class	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?php
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**************************************************************************\
   * smtp mailer                                                              *
   * Written by Itzchak Rehberg <izzysoft@qumran.org>                         *
@@ -11,7 +13,7 @@
   * the function send() - unless you are really sure what you are doing!     *
   \**************************************************************************/
 
-  /* $Id: upgrade_2-5-5pre1_to_2-5-5.patch,v 1.1 2005/05/08 20:44:54 phpzen Exp $ */
+  /* $Id: upgrade_2-5-5pre1_to_2-5-5.patch,v 1.1 2005/05/08 20:44:54 phpzen Exp $ */
 
 # echo "<!-- *** " . basename(__FILE__) . " starts here. *** -->\n";
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/sorting.php zentrack_2-5-5/includes/sorting.php
--- zentrack_2-5-5_pre1/includes/sorting.php	2005-03-11 07:37:36.000000000 -0800
+++ zentrack_2-5-5/includes/sorting.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
    * Parses sorting data and stores in session
    * creates a single string which can be passed
@@ -8,7 +10,7 @@
   $sm =& $zen->getSessionManager();
   $orderby  = $sm->find('ztorderby');
   if( !$orderby ) {
-    $orderby = array('status DESC','priority DESC','otime DESC');
+    $orderby = array('priority DESC','otime DESC');
     $sm->store('ztorderby', $orderby);
   }
   
@@ -25,9 +27,8 @@
   if( $newsort ) {
     // if we have a valid sorting field, drop it into our stuff.
     $ordervals = array( preg_replace('/[^0-9a-zA-Z_ ]/', '', $newsort) );
-    $count = 0;
-    foreach($orderby as $v) {
-      if( ++$count > 3 ) { break; }
+    for($i=0; $i<count($orderby) && count($ordervals)<2; $i++) {
+      $v = $orderby[$i];
       $ok = true;
       if( $v == $newsort ) { $ok = false; }
       else if( strpos($v, " DESC") > 0 ) {
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/accessForm.php zentrack_2-5-5/includes/templates/accessForm.php
--- zentrack_2-5-5_pre1/includes/templates/accessForm.php	2003-08-28 14:49:15.000000000 -0700
+++ zentrack_2-5-5/includes/templates/accessForm.php	2005-05-01 23:59:36.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // fetch a list of bins for new bins
   $userBins = $zen->getBins();
 
@@ -59,7 +61,7 @@
   // option tags for the access levels
   function opt_lvls( $selected = '' ) {
     print "<option value=''>---</option>\n";
-    for( $i=0; $i<6; $i++ ) {
+    for( $i=0; $i<11; $i++ ) {
       $sel = (strlen($selected) && $i==$selected)? 
 	" selected" : "";
       print "<option$sel>$i</option>\n";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/assign.php zentrack_2-5-5/includes/templates/actions/assign.php
--- zentrack_2-5-5_pre1/includes/templates/actions/assign.php	2003-03-23 23:25:04.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/assign.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/close.php zentrack_2-5-5/includes/templates/actions/close.php
--- zentrack_2-5-5_pre1/includes/templates/actions/close.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/close.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   $view = 'ticket_close';
   $fields = $map->getFieldMap($view);
   $hidden_fields = array();
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/contacts.php zentrack_2-5-5/includes/templates/actions/contacts.php
--- zentrack_2-5-5_pre1/includes/templates/actions/contacts.php	2004-11-16 05:14:30.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/contacts.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
    * creates a form for adding entries to the contact list
    */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/email.php zentrack_2-5-5/includes/templates/actions/email.php
--- zentrack_2-5-5_pre1/includes/templates/actions/email.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/email.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 
 <script language="javascript">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/estimate.php zentrack_2-5-5/includes/templates/actions/estimate.php
--- zentrack_2-5-5_pre1/includes/templates/actions/estimate.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/estimate.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/log.php zentrack_2-5-5/includes/templates/actions/log.php
--- zentrack_2-5-5_pre1/includes/templates/actions/log.php	2004-11-01 11:19:22.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/log.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/move.php zentrack_2-5-5/includes/templates/actions/move.php
--- zentrack_2-5-5_pre1/includes/templates/actions/move.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/move.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/notify.php zentrack_2-5-5/includes/templates/actions/notify.php
--- zentrack_2-5-5_pre1/includes/templates/actions/notify.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/actions/notify.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
    * creates a form for adding entries to the
    * ticket notify list
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/reject.php zentrack_2-5-5/includes/templates/actions/reject.php
--- zentrack_2-5-5_pre1/includes/templates/actions/reject.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/reject.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/relate.php zentrack_2-5-5/includes/templates/actions/relate.php
--- zentrack_2-5-5_pre1/includes/templates/actions/relate.php	2004-08-09 01:10:05.000000000 -0700
+++ zentrack_2-5-5/includes/templates/actions/relate.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>" name='relateTicketForm'>
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/reopen.php zentrack_2-5-5/includes/templates/actions/reopen.php
--- zentrack_2-5-5_pre1/includes/templates/actions/reopen.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/reopen.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/test.php zentrack_2-5-5/includes/templates/actions/test.php
--- zentrack_2-5-5_pre1/includes/templates/actions/test.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/test.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/upload.php zentrack_2-5-5/includes/templates/actions/upload.php
--- zentrack_2-5-5_pre1/includes/templates/actions/upload.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/upload.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form enctype="multipart/form-data" action="<?=$SCRIPT_NAME?>" method="post">
   <input type="hidden" name="MAX_FILE_SIZE" value="<?=$zen->settings["attachment_max_size"]?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/varfield_edit.php zentrack_2-5-5/includes/templates/actions/varfield_edit.php
--- zentrack_2-5-5_pre1/includes/templates/actions/varfield_edit.php	2005-03-08 08:04:40.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/varfield_edit.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,5 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   include("$libDir/templates/ticket_systemBox.php");
 ?>
\ No newline at end of file
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/actions/yank.php zentrack_2-5-5/includes/templates/actions/yank.php
--- zentrack_2-5-5_pre1/includes/templates/actions/yank.php	2003-03-23 23:25:05.000000000 -0800
+++ zentrack_2-5-5/includes/templates/actions/yank.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 <input type="hidden" name="id" value="<?=$id?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/adminMenu.php zentrack_2-5-5/includes/templates/adminMenu.php
--- zentrack_2-5-5_pre1/includes/templates/adminMenu.php	2005-03-11 08:15:53.000000000 -0800
+++ zentrack_2-5-5/includes/templates/adminMenu.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <br>
 <ul>
   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/agreementView.php zentrack_2-5-5/includes/templates/agreementView.php
--- zentrack_2-5-5_pre1/includes/templates/agreementView.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/agreementView.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 	<?
 	$sort = "dtime asc";
 	$parms = array(1 => array(1 => "status", 2 => "=", 3 => "1")
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/agreement_box.php zentrack_2-5-5/includes/templates/agreement_box.php
--- zentrack_2-5-5_pre1/includes/templates/agreement_box.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/agreement_box.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 /* 
 *Show the contacts that are connected to a company
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/agreement_list.php zentrack_2-5-5/includes/templates/agreement_list.php
--- zentrack_2-5-5_pre1/includes/templates/agreement_list.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/agreement_list.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 /* 
 *Show the contacts that are connected to a company
 */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/behaviorDetailForm.php zentrack_2-5-5/includes/templates/behaviorDetailForm.php
--- zentrack_2-5-5_pre1/includes/templates/behaviorDetailForm.php	2004-11-10 13:21:00.000000000 -0800
+++ zentrack_2-5-5/includes/templates/behaviorDetailForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
    // some elements of page are presented slightly different, although
    // data structure remains the same, when we plan to deal with groups
    // created from files
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/behaviorForm.php zentrack_2-5-5/includes/templates/behaviorForm.php
--- zentrack_2-5-5_pre1/includes/templates/behaviorForm.php	2004-10-11 16:35:28.000000000 -0700
+++ zentrack_2-5-5/includes/templates/behaviorForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // generate some text to display based on whether this
   // is an edit page or an add page
   $td = ($TODO == 'EDIT');
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/behaviorMenu.php zentrack_2-5-5/includes/templates/behaviorMenu.php
--- zentrack_2-5-5_pre1/includes/templates/behaviorMenu.php	2005-01-30 23:05:48.000000000 -0800
+++ zentrack_2-5-5/includes/templates/behaviorMenu.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
          $elnk="$rootUrl/admin/editBehavior.php";
          $llnk="$rootUrl/admin/editBehaviorDetails.php";
          $dlnk="$rootUrl/admin/deleteBehavior.php";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/binForm.php zentrack_2-5-5/includes/templates/binForm.php
--- zentrack_2-5-5_pre1/includes/templates/binForm.php	2004-09-09 02:33:22.000000000 -0700
+++ zentrack_2-5-5/includes/templates/binForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
       <br>
       <p class='error'><?
          $str = "<a href='$rootUrl/help/find.php?s=admin&p=varfields'>".tr('Documentation')."</a>";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/bugForm.php zentrack_2-5-5/includes/templates/bugForm.php
--- zentrack_2-5-5_pre1/includes/templates/bugForm.php	2004-09-09 03:20:16.000000000 -0700
+++ zentrack_2-5-5/includes/templates/bugForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form name='bugForm' method='post'>
 <table>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/configForm.php zentrack_2-5-5/includes/templates/configForm.php
--- zentrack_2-5-5_pre1/includes/templates/configForm.php	2004-10-11 16:35:28.000000000 -0700
+++ zentrack_2-5-5/includes/templates/configForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
       <br>
       <p class='error'><?
          $str = "<a href='$rootUrl/help/find.php?s=admin&p=data_types'>".tr('Documentation')."</a>";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/configSettingsForm.php zentrack_2-5-5/includes/templates/configSettingsForm.php
--- zentrack_2-5-5_pre1/includes/templates/configSettingsForm.php	2004-11-01 11:19:22.000000000 -0800
+++ zentrack_2-5-5/includes/templates/configSettingsForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
       <br>
       <p><b><?=tr("Changing these settings can have a severe impact on the system.  Please consider this before making modifications.")?></b></p>
       <p class='error'><?
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contactView.php zentrack_2-5-5/includes/templates/contactView.php
--- zentrack_2-5-5_pre1/includes/templates/contactView.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contactView.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /*
   **  CONTACT VIEW
   **
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_!19Box.php zentrack_2-5-5/includes/templates/contact_!19Box.php
--- zentrack_2-5-5_pre1/includes/templates/contact_!19Box.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_!19Box.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_abcBox.php zentrack_2-5-5/includes/templates/contact_abcBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_abcBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_abcBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_allBox.php zentrack_2-5-5/includes/templates/contact_allBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_allBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_allBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table width="645" cellpadding="0" cellspacing="0" border="0">
 <tr> 
   <td class="ticketCell" height="300" valign="top">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_box.php zentrack_2-5-5/includes/templates/contact_box.php
--- zentrack_2-5-5_pre1/includes/templates/contact_box.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_box.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table width="645" cellpadding="0" cellspacing="0" border="0">
 <tr> 
 <td valign="bottom">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_buttonBox.php zentrack_2-5-5/includes/templates/contact_buttonBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_buttonBox.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_buttonBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table width="120" cellpadding="0" cellspacing="0" border="0">
 <tr>
 <?
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_defBox.php zentrack_2-5-5/includes/templates/contact_defBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_defBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_defBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_ghiBox.php zentrack_2-5-5/includes/templates/contact_ghiBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_ghiBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_ghiBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_jklBox.php zentrack_2-5-5/includes/templates/contact_jklBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_jklBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_jklBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_list.php zentrack_2-5-5/includes/templates/contact_list.php
--- zentrack_2-5-5_pre1/includes/templates/contact_list.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_list.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 /* 
 *Show the contacts that are connected to a company
 */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_mnoBox.php zentrack_2-5-5/includes/templates/contact_mnoBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_mnoBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_mnoBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_personBox.php zentrack_2-5-5/includes/templates/contact_personBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_personBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_personBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 /* 
 *Show the contacts that are connected to a company
 */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_pqrsBox.php zentrack_2-5-5/includes/templates/contact_pqrsBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_pqrsBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_pqrsBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_titleBox.php zentrack_2-5-5/includes/templates/contact_titleBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_titleBox.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_titleBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table cellpadding="0" cellspacing="0">
   <tr>
    <td class="ticketCell"><table 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_tuvBox.php zentrack_2-5-5/includes/templates/contact_tuvBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_tuvBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_tuvBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/contact_wxyzBox.php zentrack_2-5-5/includes/templates/contact_wxyzBox.php
--- zentrack_2-5-5_pre1/includes/templates/contact_wxyzBox.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/contact_wxyzBox.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/customGroupDetailsForm.php zentrack_2-5-5/includes/templates/customGroupDetailsForm.php
--- zentrack_2-5-5_pre1/includes/templates/customGroupDetailsForm.php	2004-08-04 04:52:18.000000000 -0700
+++ zentrack_2-5-5/includes/templates/customGroupDetailsForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
       <br>
       <p class='error'><?=tr("Select the items that will appear in this group and their order.")?></p>
       <ul>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/editAgreementForm.php zentrack_2-5-5/includes/templates/editAgreementForm.php
--- zentrack_2-5-5_pre1/includes/templates/editAgreementForm.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/editAgreementForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   $skip = 0;
   
   $agreement = $zen->get_contact($id,"ZENTRACK_AGREEMENT","agree_id");
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/editContactForm.php zentrack_2-5-5/includes/templates/editContactForm.php
--- zentrack_2-5-5_pre1/includes/templates/editContactForm.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/editContactForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   $skip = 0;
   $id = NULL;
   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/editCustomsForm.php zentrack_2-5-5/includes/templates/editCustomsForm.php
--- zentrack_2-5-5_pre1/includes/templates/editCustomsForm.php	2004-09-27 22:24:16.000000000 -0700
+++ zentrack_2-5-5/includes/templates/editCustomsForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 
       <p class='bigBold'><?=tr('Edit Variable Fields')?></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/editTicketForm.php zentrack_2-5-5/includes/templates/editTicketForm.php
--- zentrack_2-5-5_pre1/includes/templates/editTicketForm.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/editTicketForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // if there is an ID, open it up
   // otherwise, ask for the ticket ID
   $skip = 0;
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/fieldMapForm.php zentrack_2-5-5/includes/templates/fieldMapForm.php
--- zentrack_2-5-5_pre1/includes/templates/fieldMapForm.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/fieldMapForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
     PREREQUISITES:
       $map - (ZenFieldMap) map object which can be used to retrieve default values
@@ -97,11 +99,11 @@
     $fn = "document.fieldMapForm";
     // up arrow
     $txt .= "<a href='#' onClick='moveRowUp(this.parentNode);return false;'";
-    $txt .= " border='0' alt='Move Up' title='Move Up'><img src='/images/icon_arrow_up.gif'";
+    $txt .= " border='0' alt='Move Up' title='Move Up'><img src='$rootUrl/images/icon_arrow_up.gif'";
     $txt .= " width='16' height='16' alt='Move Up' title='Move Up' border='0'></a>";
     // down arrow
     $txt .= "<a href='#' onClick='moveRowDown(this.parentNode);return false;'";
-    $txt .= " border='0' alt='Move Down' title='Move Down'><img src='/images/icon_arrow_down.gif'";
+    $txt .= " border='0' alt='Move Down' title='Move Down'><img src='$rootUrl/images/icon_arrow_down.gif'";
     $txt .= " width='16' height='16' alt='Move Down' title='Move Down' border='0'></a>";
     // control sort ordering by tracking what order these hidden fields arrive
     $txt .= "<input type='hidden' name='orderset[$f]' value='$fcount'>";
@@ -109,13 +111,13 @@
     if( $field['field_type'] == 'section' && $field['field_name'] != 'elapsed' ) {
       // remove sections
       $txt .= "<a href='#' onClick='removeRow(this);return false;'";
-      $txt .= " border='0' alt='Remove Section' title='Remove Section'><img src='/images/icon_trash.gif'";
+      $txt .= " border='0' alt='Remove Section' title='Remove Section'><img src='$rootUrl/images/icon_trash.gif'";
       $txt .= " width='16' height='16' alt='Remove Section' title='Remove Section' border='0'></a>";
     }
     else {
       // add new sections
       $txt .= "<a href='#' onClick='addRow(this);return false;'";
-      $txt .= " border='0' alt='Add Section' title='Add Section'><img src='/images/icon_add.gif'";
+      $txt .= " border='0' alt='Add Section' title='Add Section'><img src='$rootUrl/images/icon_add.gif'";
       $txt .= " width='16' height='16' alt='Add Section' title='Add Section' border='0'></a>";
     }
   }
@@ -164,7 +166,7 @@
         $txt = "<select ".fmfName($f,'default_val').">";
         $txt .= "<option value=''>--</option>";
         foreach($choices as $k=>$v) {
-          $sel = $field['default_val'] === $k? " selected" : "";
+          $sel = $field['default_val'] == $k? " selected" : "";
           $txt .= "<option value='$k'{$sel}>$v</option>";
         }
         $txt .= "</select>";
@@ -183,10 +185,12 @@
     }
     else {
       $txt = "<select style='width:80px;' ".fmfName($f, 'field_type').">";
-      foreach($fprops['types'] as $t) {
-        if( $view == 'search_form' && $t == 'checkbox' ) { continue; }
-        $sel = ( $field['field_type'] == $t )? ' selected':'';
-        $txt .= "<option value='$t'$sel>$t</option>\n";
+      if (count($fprops['types'])>0) {
+        foreach($fprops['types'] as $t) {
+          if( $view == 'search_form' && $t == 'checkbox' ) { continue; }
+          $sel = ( $field['field_type'] == $t )? ' selected':'';
+          $txt .= "<option value='$t'$sel>$t</option>\n";
+        }
       }
       $txt .= "</select>";
       fmfRow($txt,$class);
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/fields/label.template zentrack_2-5-5/includes/templates/fields/label.template
--- zentrack_2-5-5_pre1/includes/templates/fields/label.template	2005-02-02 06:45:34.000000000 -0800
+++ zentrack_2-5-5/includes/templates/fields/label.template	2005-03-31 12:11:54.000000000 -0800
@@ -1,2 +1,2 @@
 
-<input type='hidden' name='{field_name}' value='{field_value}'>{field_label}
+<input type='hidden' name='{field_name}' value='{field_value}'><div id='{field_name}LabelText'>{field_label}</div>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/groupAdd.php zentrack_2-5-5/includes/templates/groupAdd.php
--- zentrack_2-5-5_pre1/includes/templates/groupAdd.php	2004-10-11 16:35:28.000000000 -0700
+++ zentrack_2-5-5/includes/templates/groupAdd.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // generate some text to display based on whether this
   // is an edit page or an add page
   $td = ($TODO == 'EDIT');
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/groupDetailsForm.php zentrack_2-5-5/includes/templates/groupDetailsForm.php
--- zentrack_2-5-5_pre1/includes/templates/groupDetailsForm.php	2004-09-27 22:24:16.000000000 -0700
+++ zentrack_2-5-5/includes/templates/groupDetailsForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
       <br>
       <p class='error'><?=tr("Select the items that will appear in this group and their order.")?></p>
       <ul>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/groupForm.php zentrack_2-5-5/includes/templates/groupForm.php
--- zentrack_2-5-5_pre1/includes/templates/groupForm.php	2004-11-10 13:21:00.000000000 -0800
+++ zentrack_2-5-5/includes/templates/groupForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
          $elnk="$rootUrl/admin/editGroup.php";
          $llnk="$rootUrl/admin/editGroupDetails.php";
          $dlnk="$rootUrl/admin/deleteGroup.php";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/homebinForm.php zentrack_2-5-5/includes/templates/homebinForm.php
--- zentrack_2-5-5_pre1/includes/templates/homebinForm.php	2003-05-22 00:11:24.000000000 -0700
+++ zentrack_2-5-5/includes/templates/homebinForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$SCRIPT_NAME?>">
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/languageForm.php zentrack_2-5-5/includes/templates/languageForm.php
--- zentrack_2-5-5_pre1/includes/templates/languageForm.php	2003-05-03 03:07:43.000000000 -0700
+++ zentrack_2-5-5/includes/templates/languageForm.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" action="<?=$rootUrl?>/misc/language.php">
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/listContacts.php zentrack_2-5-5/includes/templates/listContacts.php
--- zentrack_2-5-5_pre1/includes/templates/listContacts.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/listContacts.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 /*
 *Company bar to show some info
 */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/listContacts2.php zentrack_2-5-5/includes/templates/listContacts2.php
--- zentrack_2-5-5_pre1/includes/templates/listContacts2.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/listContacts2.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 /*
 *Person bar to show some info
 */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/listTickets.php zentrack_2-5-5/includes/templates/listTickets.php
--- zentrack_2-5-5_pre1/includes/templates/listTickets.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/listTickets.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,10 +1,11 @@
 <?
+  if( !ZT_DEFINED ) { die("Illegal access"); }
 
   /**
    PREREQUISITES:
      (ZenFieldMap)$map - contains properties for fields
      (string)$view - the current view (probably project_list or ticket_list)
-     (array)$fields - properties for fields to be rendered, obtained from ZenFieldMap::getFieldMap( view )
+     (array)$fields - [optional]properties for fields to be rendered, obtained from ZenFieldMap::getFieldMap( view )
      (string)$page_type - (optional) either 'ticket' or 'project'
      (array)$tickets - list of tickets to be displayed, as retrieved from zenTrack::get_tickets()
   **/
@@ -12,6 +13,9 @@
 if( !$page_type )
   $page_type = "ticket";
   
+$fields = $map->getFieldMap($view);
+include_once("$libDir/sorting.php");
+  
 if( is_array($tickets) && count($tickets) ) {
 ?>
 <script type='text/javascript'>
@@ -135,7 +139,7 @@
           print $zen->showTimeElapsed($t["otime"],$t["ctime"],1,1);
         }
         else {
-          $value = strpos($f, 'custom_')===0? $custom_fields[$f] : $t[$f];
+          $value = strpos($f, 'custom_')===0? $custom_fields[$t["id"]][$f] : $t[$f];
           print $map->getTextValue($view, $f, $value);
         }
         print "</a></td>\n";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/listTickets_workFormat.php zentrack_2-5-5/includes/templates/listTickets_workFormat.php
--- zentrack_2-5-5_pre1/includes/templates/listTickets_workFormat.php	2003-05-22 00:11:25.000000000 -0700
+++ zentrack_2-5-5/includes/templates/listTickets_workFormat.php	2005-05-01 23:59:37.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   
 if( is_array($tickets) ) {
  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/newAgreementForm.php zentrack_2-5-5/includes/templates/newAgreementForm.php
--- zentrack_2-5-5_pre1/includes/templates/newAgreementForm.php	2004-11-23 11:24:23.000000000 -0800
+++ zentrack_2-5-5/includes/templates/newAgreementForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <script language='javascript' type='text/javascript'>
   function checkMyBox(fieldName, event) {
     if( !event ) { event = window.event; }
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/newContactForm.php zentrack_2-5-5/includes/templates/newContactForm.php
--- zentrack_2-5-5_pre1/includes/templates/newContactForm.php	2004-10-27 12:15:31.000000000 -0700
+++ zentrack_2-5-5/includes/templates/newContactForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" name="contactForm" action="<?=($skip)? "editContactSubmit.php" : "$rootUrl/addContactSubmit.php"?>">
 <input type="hidden" name="id" value="<?=strip_tags($id)?>">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/newContacteForm.php zentrack_2-5-5/includes/templates/newContacteForm.php
--- zentrack_2-5-5_pre1/includes/templates/newContacteForm.php	2004-10-27 12:15:31.000000000 -0700
+++ zentrack_2-5-5/includes/templates/newContacteForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <form method="post" name="contactForm" action="<?=($skip)? "editContacteSubmit.php" : "$rootUrl/addContacteSubmit.php"?>">
 <?
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/newTicketForm.php zentrack_2-5-5/includes/templates/newTicketForm.php
--- zentrack_2-5-5_pre1/includes/templates/newTicketForm.php	2005-03-10 19:16:28.000000000 -0800
+++ zentrack_2-5-5/includes/templates/newTicketForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?  
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
    PREREQUISITES:
      (ZenFieldMap)$map - contains properties for fields
@@ -98,7 +100,13 @@
     print "<tr><td class='bars'>";
     print $map->getLabel($view, $f);
     print "</td><td class='bars'>";
-    print $map->renderTicketField($view, 'ticketForm', $f, $$f);
+    if( $td && $page_type == 'project' && $f == 'type_id' ) {
+      // do not allow type to be edited for projects
+      print $map->getTextValue($view, $f, $$f);
+    }
+    else {
+      print $map->renderTicketField($view, 'ticketForm', $f, $$f);
+    }
     print "</td></tr>\n";
   }
 }
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/optionsMenu.php zentrack_2-5-5/includes/templates/optionsMenu.php
--- zentrack_2-5-5_pre1/includes/templates/optionsMenu.php	2005-02-09 05:56:14.000000000 -0800
+++ zentrack_2-5-5/includes/templates/optionsMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <br>
 <ul>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/projectView.php zentrack_2-5-5/includes/templates/projectView.php
--- zentrack_2-5-5_pre1/includes/templates/projectView.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/projectView.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /*
   **  PROJECT VIEW
   **
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/pwcForm.php zentrack_2-5-5/includes/templates/pwcForm.php
--- zentrack_2-5-5_pre1/includes/templates/pwcForm.php	2003-05-22 00:11:25.000000000 -0700
+++ zentrack_2-5-5/includes/templates/pwcForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   $user = $zen->getUser($login_id);
   if( $user["passphrase"] == $zen->encval($user["lname"]) ) {
     print "<p class='hot'>".tr("Your passphrase is currently set to the system default.  Please change it.")."</p>\n";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/referencedGroupForm.php zentrack_2-5-5/includes/templates/referencedGroupForm.php
--- zentrack_2-5-5_pre1/includes/templates/referencedGroupForm.php	2004-10-19 11:44:11.000000000 -0700
+++ zentrack_2-5-5/includes/templates/referencedGroupForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
          $elnk="$rootUrl/admin/deleteGroup.php";
 ?>
       <br>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportMenu.php zentrack_2-5-5/includes/templates/reportMenu.php
--- zentrack_2-5-5_pre1/includes/templates/reportMenu.php	2004-02-27 03:37:46.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table width='300'>
 <tr>
   <td class='titleCell' align='center'><?=tr("View Reports")?></td>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsDataMenu.php zentrack_2-5-5/includes/templates/reportsDataMenu.php
--- zentrack_2-5-5_pre1/includes/templates/reportsDataMenu.php	2003-03-23 23:25:02.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsDataMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <!-- DATA MENU -->
 
 <?
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsDateMenu.php zentrack_2-5-5/includes/templates/reportsDateMenu.php
--- zentrack_2-5-5_pre1/includes/templates/reportsDateMenu.php	2003-03-23 23:25:02.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsDateMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <!-- DATE MENU -->
 <?
   // validate data
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsMenu.php zentrack_2-5-5/includes/templates/reportsMenu.php
--- zentrack_2-5-5_pre1/includes/templates/reportsMenu.php	2003-03-23 23:25:02.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="640" align="left" cellpadding="2" cellspacing="2" bgcolor="<?=$zen->settings["color_background"]?>">
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsOptionsMenu.php zentrack_2-5-5/includes/templates/reportsOptionsMenu.php
--- zentrack_2-5-5_pre1/includes/templates/reportsOptionsMenu.php	2003-03-23 23:25:02.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsOptionsMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <!-- OPTIONS MENU -->
 <?
   // validation
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsSubmit.php zentrack_2-5-5/includes/templates/reportsSubmit.php
--- zentrack_2-5-5_pre1/includes/templates/reportsSubmit.php	2003-03-23 23:25:03.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsSubmit.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <!-- SUBMIT MENU -->
 <tr>
   <td class='<?=($tf_options)? "titleCell" : "subTitle" ?>' colspan='3'>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsTasks.php zentrack_2-5-5/includes/templates/reportsTasks.php
--- zentrack_2-5-5_pre1/includes/templates/reportsTasks.php	2003-01-03 22:11:49.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsTasks.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 Form for detailed input of report parameters:
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/reportsTypeMenu.php zentrack_2-5-5/includes/templates/reportsTypeMenu.php
--- zentrack_2-5-5_pre1/includes/templates/reportsTypeMenu.php	2003-03-23 23:25:03.000000000 -0800
+++ zentrack_2-5-5/includes/templates/reportsTypeMenu.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // set a toggle
   if( $report_type )
      $report_type = $zen->checkAlphaNum($report_type,"_ ");
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchContact2List.php zentrack_2-5-5/includes/templates/searchContact2List.php
--- zentrack_2-5-5_pre1/includes/templates/searchContact2List.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/searchContact2List.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?  
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 if( is_array($tickets) && count($tickets) ) {
  
    $link = $zen->settings["url_view_ticket"];   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchContact3List.php zentrack_2-5-5/includes/templates/searchContact3List.php
--- zentrack_2-5-5_pre1/includes/templates/searchContact3List.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/searchContact3List.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?  
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 if( is_array($tickets) && count($tickets) ) {
  
    $link = $zen->settings["url_view_ticket"];   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchContact4List.php zentrack_2-5-5/includes/templates/searchContact4List.php
--- zentrack_2-5-5_pre1/includes/templates/searchContact4List.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/searchContact4List.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?  
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 if( is_array($tickets) && count($tickets) ) {
  
    $link = $zen->settings["url_view_ticket"];   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchContactForm.php zentrack_2-5-5/includes/templates/searchContactForm.php
--- zentrack_2-5-5_pre1/includes/templates/searchContactForm.php	2004-11-01 11:19:22.000000000 -0800
+++ zentrack_2-5-5/includes/templates/searchContactForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 
 <form action="<?=($SCRIPT_NAME)?>" name="searchCompany">
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchContactList.php zentrack_2-5-5/includes/templates/searchContactList.php
--- zentrack_2-5-5_pre1/includes/templates/searchContactList.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/searchContactList.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?  
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 if( is_array($tickets) && count($tickets) ) {
  
    $link = $zen->settings["url_view_ticket"];   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchContactResults.php zentrack_2-5-5/includes/templates/searchContactResults.php
--- zentrack_2-5-5_pre1/includes/templates/searchContactResults.php	2004-09-02 09:40:51.000000000 -0700
+++ zentrack_2-5-5/includes/templates/searchContactResults.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <?{
 	
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchForm.php zentrack_2-5-5/includes/templates/searchForm.php
--- zentrack_2-5-5_pre1/includes/templates/searchForm.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/searchForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
    PREREQUISITES:
      (ZenFieldMap)$map - contains properties for fields
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchLogForm.php zentrack_2-5-5/includes/templates/searchLogForm.php
--- zentrack_2-5-5_pre1/includes/templates/searchLogForm.php	2004-11-01 11:19:22.000000000 -0800
+++ zentrack_2-5-5/includes/templates/searchLogForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // create a default date
   if( !$search_date )
     $search_date = 0;
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchLogList.php zentrack_2-5-5/includes/templates/searchLogList.php
--- zentrack_2-5-5_pre1/includes/templates/searchLogList.php	2004-11-01 11:19:22.000000000 -0800
+++ zentrack_2-5-5/includes/templates/searchLogList.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 if( is_array($logs) && count($logs) ) {
   
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchLogResults.php zentrack_2-5-5/includes/templates/searchLogResults.php
--- zentrack_2-5-5_pre1/includes/templates/searchLogResults.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/searchLogResults.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   // integrity
   $params = array();
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/searchResults.php zentrack_2-5-5/includes/templates/searchResults.php
--- zentrack_2-5-5_pre1/includes/templates/searchResults.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/searchResults.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   
   include("$libDir/sorting.php");
   
@@ -85,7 +87,7 @@
               if( is_array($v) ) {
                 $v = array_reduce($v, "searchResultsMaxPri");
               }
-              $params[] = array($zen->table_tickets.".$k",'<=',$vh,1);
+              $params[] = array($zen->table_tickets.".$k",'<=',$v,1);
             }
             else {
               $params[] = array($zen->table_tickets.".$k",$op,$v,1);
@@ -159,4 +161,4 @@
     $tickets = $zen->search_tickets($params, "AND", "0", join(',',$orderby), $limit);//"status DESC, priority DESC"
   }
   
-}?>
\ No newline at end of file
+}?>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticketView.php zentrack_2-5-5/includes/templates/ticketView.php
--- zentrack_2-5-5_pre1/includes/templates/ticketView.php	2003-03-06 00:29:54.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticketView.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /*
   **  TICKET VIEW
   **
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_actionBar.php zentrack_2-5-5/includes/templates/ticket_actionBar.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_actionBar.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/ticket_actionBar.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 
 <!-- BEGIN ACTION BAR -->
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_attachmentsBox.php zentrack_2-5-5/includes/templates/ticket_attachmentsBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_attachmentsBox.php	2004-11-25 12:03:44.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_attachmentsBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
    $rollover_text = " onclick=\"mClk(this);\" "
       ."onmouseout=\"mOut(this,'".$zen->settings["color_background"]."', '');\" "
       ."onmouseover=\"mOvr(this,'".$zen->settings["color_bars"]."', '');\"";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_box.php zentrack_2-5-5/includes/templates/ticket_box.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_box.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_box.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table width="645" cellpadding="0" cellspacing="0" border="0">
 <tr> 
   <td valign="bottom"><?
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_contactsBox.php zentrack_2-5-5/includes/templates/ticket_contactsBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_contactsBox.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/ticket_contactsBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   // security measure
   if( $login_level < $zen->settings['level_contacts'] ) {
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_customBox.php zentrack_2-5-5/includes/templates/ticket_customBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_customBox.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_customBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <? 
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 if( $TODO == 'SAVED' ) {
   $zen->print_errors($errs); 
   if( $save_message ) {
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_detailsBox.php zentrack_2-5-5/includes/templates/ticket_detailsBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_detailsBox.php	2005-02-09 05:56:14.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_detailsBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
@@ -75,7 +76,7 @@
     <td class="smallTitleCell"><?=uptr("Hours Worked")?></td>  
   </tr>
    <tr>
-    <td><?=($ctime)?$zen->showDate($ctime):tr("n/a")?></td>    
+    <td><?=($ctime)?$zen->showDateTime($ctime):tr("n/a")?></td>    
     <td><? 
       switch($tested){
         case 1: 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_logBox.php zentrack_2-5-5/includes/templates/ticket_logBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_logBox.php	2004-11-01 11:19:22.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_logBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <table width="600" align="center" cellpadding="2" cellspacing="2">
       <?
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_notifyBox.php zentrack_2-5-5/includes/templates/ticket_notifyBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_notifyBox.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/ticket_notifyBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <table width="600" align="center" cellpadding="2" cellspacing="2">
   <tr> 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_relatedBox.php zentrack_2-5-5/includes/templates/ticket_relatedBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_relatedBox.php	2004-09-08 01:22:42.000000000 -0700
+++ zentrack_2-5-5/includes/templates/ticket_relatedBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
@@ -10,14 +11,17 @@
 <?
   $tickets = false;
   if( $page_type == "ticket" ) {
+    $view='ticket_list';
     $ticket = $zen->get_ticket($id);
   } else {
+    $view='project_list';
     $ticket = $zen->get_project($id);
   }
   if( $ticket["relations"] ) {
      $tids = explode(",", $ticket["relations"]);
      $tickets = $zen->get_tickets( array("id"=>$tids) );
   }
+  $fields=$map->getFieldMap($view);
   if( is_array($tickets) && count($tickets) ) {
      include("$templateDir/listTickets.php");
   } else {
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_reportBox.php zentrack_2-5-5/includes/templates/ticket_reportBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_reportBox.php	2002-03-19 01:11:54.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_reportBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <table width="600" align="center" cellpadding="2" cellspacing="2">
    <tr>  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_systemBox.php zentrack_2-5-5/includes/templates/ticket_systemBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_systemBox.php	2003-03-23 23:25:04.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_systemBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   
   if( $action ) {   
      
@@ -13,7 +15,7 @@
        include("$templateDir/actions/$action.php");
      }
      else {
-       print "<p class='error'>".tr("Invalid action declared")."</p>\n";
+       print "<p class='error'>".tr("Invalid action declared")." (".$zen->ffv($action).")</p>\n";
      }
   
      print "<p>&nbsp;</p>\n";
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_tasksBox.php zentrack_2-5-5/includes/templates/ticket_tasksBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_tasksBox.php	2003-03-23 23:25:04.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_tasksBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
   <table width="600" align="center" cellpadding="2" cellspacing="2">
   <tr> 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/ticket_titleBox.php zentrack_2-5-5/includes/templates/ticket_titleBox.php
--- zentrack_2-5-5_pre1/includes/templates/ticket_titleBox.php	2005-02-28 12:02:31.000000000 -0800
+++ zentrack_2-5-5/includes/templates/ticket_titleBox.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <table width="560" cellpadding="0" cellspacing="0">
   <tr>
    <td class="ticketCell"><table 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/add_attachment.php zentrack_2-5-5/includes/templates/tutorial/english/add_attachment.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/add_attachment.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/add_attachment.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Attachments</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/bins.php zentrack_2-5-5/includes/templates/tutorial/english/bins.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/bins.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/bins.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Bins and the Move feature</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/close_ticket.php zentrack_2-5-5/includes/templates/tutorial/english/close_ticket.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/close_ticket.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/close_ticket.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <p align='center' class='bigbold'>Closing Tickets</p>
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/closure.php zentrack_2-5-5/includes/templates/tutorial/english/closure.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/closure.php	2004-09-09 02:33:22.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/closure.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Thanks for Reading the Tutorial</p>
 
 <p>Hopefully this walkthrough has been somewhat useful to you and hasn't resulted
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/contacts.php zentrack_2-5-5/includes/templates/tutorial/english/contacts.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/contacts.php	2004-09-09 02:33:22.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/contacts.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Contacts</p>
 
 <b>Important Note:</b> If contacts are not useful to your organization, they
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/create_ticket.php zentrack_2-5-5/includes/templates/tutorial/english/create_ticket.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/create_ticket.php	2004-09-09 02:33:22.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/create_ticket.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Creating a New Ticket</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/introduction.php zentrack_2-5-5/includes/templates/tutorial/english/introduction.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/introduction.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/introduction.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Introduction</p>
 
 <p>This tutorial explains the basic flowpath and actions you will need to 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/log_ticket.php zentrack_2-5-5/includes/templates/tutorial/english/log_ticket.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/log_ticket.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/log_ticket.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>The Ticket Log</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/login.php zentrack_2-5-5/includes/templates/tutorial/english/login.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/login.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/login.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Logging In</p>
 
 <p><b>Getting Login and Password</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/notify_list.php zentrack_2-5-5/includes/templates/tutorial/english/notify_list.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/notify_list.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/notify_list.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Notify Lists</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/ownership.php zentrack_2-5-5/includes/templates/tutorial/english/ownership.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/ownership.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/ownership.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Ownership of Tickets</p>
 
 <p><b>You must own a ticket for most actions</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/relate_ticket.php zentrack_2-5-5/includes/templates/tutorial/english/relate_ticket.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/relate_ticket.php	2004-09-09 02:33:22.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/relate_ticket.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Related Tickets</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/use_project.php zentrack_2-5-5/includes/templates/tutorial/english/use_project.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/use_project.php	2004-09-09 02:33:22.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/use_project.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Projects</p>
 
 <p><b>Purpose</b></p>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/tutorial/english/view_tickets.php zentrack_2-5-5/includes/templates/tutorial/english/view_tickets.php
--- zentrack_2-5-5_pre1/includes/templates/tutorial/english/view_tickets.php	2004-09-08 17:28:27.000000000 -0700
+++ zentrack_2-5-5/includes/templates/tutorial/english/view_tickets.php	2005-05-01 23:59:39.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 <p align='center' class='bigbold'>Viewing Tickets</p>
 
 <img src="<?=$tutImageUrl?>/nav_tickets.gif" 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/userAdd.php zentrack_2-5-5/includes/templates/userAdd.php
--- zentrack_2-5-5_pre1/includes/templates/userAdd.php	2004-07-01 21:56:37.000000000 -0700
+++ zentrack_2-5-5/includes/templates/userAdd.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   // generate some text to display based on whether this
   // is an edit page or an add page
   $td = ($TODO == 'EDIT');
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/userSearchForm.php zentrack_2-5-5/includes/templates/userSearchForm.php
--- zentrack_2-5-5_pre1/includes/templates/userSearchForm.php	2005-03-11 07:37:38.000000000 -0800
+++ zentrack_2-5-5/includes/templates/userSearchForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,3 +1,4 @@
+<? if( !ZT_DEFINED ) { die("Illegal Access"); } ?>
 
 <table width="640" align="left" cellpadding="2" cellspacing="2" bgcolor="<?=$zen->settings["color_background"]?>">
 <tr>
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/userSearchList.php zentrack_2-5-5/includes/templates/userSearchList.php
--- zentrack_2-5-5_pre1/includes/templates/userSearchList.php	2003-03-23 23:25:04.000000000 -0800
+++ zentrack_2-5-5/includes/templates/userSearchList.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   
 if( is_array($users) && count($users) ) {
  
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/userSearchResults.php zentrack_2-5-5/includes/templates/userSearchResults.php
--- zentrack_2-5-5_pre1/includes/templates/userSearchResults.php	2002-04-30 03:11:12.000000000 -0700
+++ zentrack_2-5-5/includes/templates/userSearchResults.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?{
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   // integrity
   unset($params);
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/templates/validateTicketForm.php zentrack_2-5-5/includes/templates/validateTicketForm.php
--- zentrack_2-5-5_pre1/includes/templates/validateTicketForm.php	2005-03-10 20:27:53.000000000 -0800
+++ zentrack_2-5-5/includes/templates/validateTicketForm.php	2005-05-01 23:59:38.000000000 -0700
@@ -1,4 +1,6 @@
 <?  
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   /**
    PREREQUISITES:
      (ZenFieldMap)$map - contains properties for fields
@@ -38,7 +40,7 @@
    var errs = new Array();
 <?
 foreach($fields as $f) {
-  $field = $map->getFieldFromMap($view,$f);
+  $field = $map->getFieldFromMap($view,$f['field_name']);
   // we don't want to validate any hidden fields using javascript, this is
   // a potential problem.
   if( $field['is_required'] && $field['is_visible'] && $field['field_type'] != 'label' ) {
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/translations/spanish.trans zentrack_2-5-5/includes/translations/spanish.trans
--- zentrack_2-5-5_pre1/includes/translations/spanish.trans	2004-11-26 08:25:40.000000000 -0800
+++ zentrack_2-5-5/includes/translations/spanish.trans	2005-03-22 08:31:41.000000000 -0800
@@ -112,7 +112,7 @@
 #file "/home/ired/zentrack_2/includes/leftMain.php"
 #args "array($num,count($zen->bins))"
 msgid "? open tickets in ? bins"
-msgstr "? tickets abiertos en ? 'bins'"
+msgstr "? tickets abiertos en ? comunidades"
 
 
 #file "/home/ired/zentrack_2/www/admin/priorities.php"
@@ -874,7 +874,7 @@
 #file "/home/ired/zentrack_2/includes/templates/actions/yank.php"
 #args ""
 msgid "Click button to yank ticket"
-msgstr "Presione el bot&oacute;n para sustraer el ticket"
+msgstr "Presione el bot&oacute;n para capturar el ticket"
 
 
 #file "/home/ired/zentrack_2/includes/templates/newAgreementForm.php"
@@ -3334,7 +3334,7 @@
 #file "/home/ired/zentrack_2/includes/templates/actions/email.php"
 #args ""
 msgid "Send a summary of the ticket"
-msgstr "Env/iacute;e un resumen del ticket"
+msgstr "Env&iacute;e un resumen del ticket"
 
 
 #file "/home/ired/zentrack_2/includes/templates/actions/email.php"
@@ -4270,7 +4270,7 @@
 #file "/home/ired/zentrack_2/includes/zenTrack.class"
 #args ""
 msgid "Ticket Summary")
-msgstr "Res&uacute;men del Ticket"
+msgstr "Resumen del Ticket"
 
 
 #file "/home/ired/zentrack_2/includes/templates/editCustomsForm.php"
@@ -4720,13 +4720,13 @@
 #file "/home/ired/zentrack_2/includes/templates/actions/yank.php"
 #args ""
 msgid "Yank Ticket"
-msgstr "Sustraer Ticket"
+msgstr "Capturar Ticket"
 
 
 #file "/home/ired/zentrack_2/includes/templates/actions/yank.php"
 #args ""
 msgid "Yank"
-msgstr "Sustraer"
+msgstr "Capturar"
 
 
 #file "/home/ired/zentrack_2/includes/templates/reportsDateMenu.php"
@@ -5842,7 +5842,7 @@
 #file "/home/ired/zentrack_2/www/help/english/users/tickets.php"
 #args ""
 msgid 'Yank'
-msgstr "Sustraer"
+msgstr "Capturar"
 
 
 #file "/home/ired/zentrack_2/includes/templates/searchLogResults.php"
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/translator.class zentrack_2-5-5/includes/translator.class
--- zentrack_2-5-5_pre1/includes/translator.class	2005-03-11 07:37:36.000000000 -0800
+++ zentrack_2-5-5/includes/translator.class	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?php
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 /**
  * The translation function wrapper
  *
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/validateFields.php zentrack_2-5-5/includes/validateFields.php
--- zentrack_2-5-5_pre1/includes/validateFields.php	1969-12-31 16:00:00.000000000 -0800
+++ zentrack_2-5-5/includes/validateFields.php	2005-05-02 00:05:52.000000000 -0700
@@ -0,0 +1,49 @@
+<?{
+  
+  /*
+  ** Validates input fields for add/edit operations
+  **
+  ** Depends on the following variables:
+  **    (String)$view - the view which will be passed into the field map
+  **    (ZenFieldMap)$map - the field map to collect field info from
+  **
+  ** Creates the following variables:
+  **    (Array)$fields - key/value pairs of (String)field => (String)data_type
+  **    (Array)$required - array of (String)field names which are required for this view
+  **    (Array)$varfield_params - contains the values needed to run $zen->updateVarfieldVals() (if any)
+  */
+  if( !ZT_DEFINED ) { die("Illegal Access"); }
+  
+  $fields = array();
+  $varfields = array();
+  $required = array();
+  $customFieldsArray = false;
+  $customFieldsArray = $map->getFieldMap($view);
+  $fprops = getFmFieldProps($view);
+  foreach($customFieldsArray as $f=>$field) {
+    //if( !$field['is_visible'] ) { continue; }
+    if( $field['is_required'] || $fprops["$f"]['always_required'] ) {
+      $required[] = $f;
+    }
+    if ( strpos($f,'custom_') === 0 ) { $varfields["$f"] = $field; }
+    else { $fields["$f"] = $fprops["$f"]['data_type']; }
+  }
+
+  $zen->cleanInput($fields);
+  
+  // check for required fields
+  foreach($required as $r) {
+    if( !strlen($$r) ) {
+      $errs[] = tr("Required field missing:") . " " . ucfirst($r);
+    }
+  }
+  
+  // parse variable fields which appear in new ticket screen, 
+  // store them in $varfield_params
+  // insure that all requirements are met before proceeding
+  // with the ticket save process
+  if( count($varfields) ) {
+    include("$libDir/parseVarfields.php");
+  }
+  
+}?>
\ No newline at end of file
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/varfieldConfig.php zentrack_2-5-5/includes/varfieldConfig.php
--- zentrack_2-5-5_pre1/includes/varfieldConfig.php	2004-08-24 01:47:58.000000000 -0700
+++ zentrack_2-5-5/includes/varfieldConfig.php	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 /**
  *  This file contains configuration settings for variable ticket fields
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/zen.class zentrack_2-5-5/includes/zen.class
--- zentrack_2-5-5_pre1/includes/zen.class	2005-02-09 05:56:12.000000000 -0800
+++ zentrack_2-5-5/includes/zen.class	2005-05-01 23:59:35.000000000 -0700
@@ -1,4 +1,6 @@
 <? /* -*- Mode: C; c-basic-indent: 3; indent-tabs-mode: nil -*- ex: set tabstop=3 expandtab: */ 
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 include_once("$libDir/zenDate.class");  
   
@@ -564,12 +566,9 @@
    /**
     * Prints the debug output collected by addDebug()
     */
-   function printDebugMessages() {  
+   function printDebugMessages() { 
      if( is_array($this->debugMessages) ) {
        $styles = array("","error","warning","note");
-       print "<p>--------<b>MESSAGES</b>--------<ul>\n";
-       print "<i>To disable this output, set \$Debug_Mode ";
-       print "in header.php to 0.</i><br>\n";
        if( is_array($this->debugMessages) ) {   
          foreach($this->debugMessages as $v) {
            $n = $v[2];
@@ -584,7 +583,6 @@
            print "\"";
          }
        }      
-       print "</ul>------<b>MESSAGES</b>------</p>\n";
      }
    }
    
@@ -645,7 +643,7 @@
    * @return boolean
    */
    function inString( $pattern, $text ) {
-     return !strlen(strpos($text, $pattern));
+     return strlen(strpos($text, $pattern));
    }
    
    /**
@@ -697,6 +695,29 @@
      }
    }
    
+  /**
+   * Merges two arrays into a single array.  Does not throw a warning if one
+   * of the arrays is null.  If the arrays are indexed, values from the second
+   * array will overwrite the first if the keys are equal.
+   *
+   * @param array $arr1
+   * @param array $arr2
+   * @return array an empty array if both values are null or empty
+   */
+   function mergeArrays($arr1, $arr2) {
+     if( is_array($arr1) && is_array($arr2) ) { return array_merge($arr1,$arr2); }
+     else if( is_array($arr1) ) { return $arr1; }
+     else if( is_array($arr2) ) { return $arr2; }
+     else { return array(); }
+   }
+   
+   /**
+    * Converts file names to an absolute path name using / characters.
+    */
+    function cleanPath( $path ) {
+      return str_replace('\\', '/', realpath($path) );
+    }
+   
    /*
    **  SYSTEM METHODS
    */
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/zenDatabase.class zentrack_2-5-5/includes/zenDatabase.class
--- zentrack_2-5-5_pre1/includes/zenDatabase.class	2002-05-06 13:49:02.000000000 -0700
+++ zentrack_2-5-5/includes/zenDatabase.class	2005-05-01 23:59:36.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
   
 class zenDatabase {
 
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/zenDate.class zentrack_2-5-5/includes/zenDate.class
--- zentrack_2-5-5_pre1/includes/zenDate.class	2004-11-27 22:33:59.000000000 -0800
+++ zentrack_2-5-5/includes/zenDate.class	2005-05-01 23:59:36.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /*
   **
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/zenGraph.class zentrack_2-5-5/includes/zenGraph.class
--- zentrack_2-5-5_pre1/includes/zenGraph.class	2005-02-28 12:02:29.000000000 -0800
+++ zentrack_2-5-5/includes/zenGraph.class	2005-05-01 23:59:36.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /*
   **  ZENGRAPH - REPORT GENERATING TOOL
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/zenTemplate.class zentrack_2-5-5/includes/zenTemplate.class
--- zentrack_2-5-5_pre1/includes/zenTemplate.class	2005-03-11 07:37:36.000000000 -0800
+++ zentrack_2-5-5/includes/zenTemplate.class	2005-05-01 23:59:36.000000000 -0700
@@ -1,4 +1,6 @@
 <?
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
   /**
    **  TEMPLATE PROCESSING ENGINE
@@ -142,7 +144,7 @@
 	    foreach($vars as $k=>$v) {
         $fv = $this->_getVar("field_value");
 	      $tmp=$str;
-	      if($fv===$k || is_array($fv) && in_array($k, $fv) || 
+	      if($fv==$k || is_array($fv) && in_array($k, $fv) || 
             (!is_array($fv) && !strlen($k) && !strlen($fv))) {
 	        $tmp = str_replace("{selected}", " selected", $tmp);
 	        $tmp = str_replace("{checked}", " checked", $tmp);
diff -x install/ -Nur zentrack_2-5-5_pre1/includes/zenTrack.class zentrack_2-5-5/includes/zenTrack.class
--- zentrack_2-5-5_pre1/includes/zenTrack.class	2005-03-11 07:37:36.000000000 -0800
+++ zentrack_2-5-5/includes/zenTrack.class	2005-05-01 23:59:36.000000000 -0700
@@ -1,4 +1,6 @@
 <? /* -*- Mode: C; c-basic-indent: 3; indent-tabs-mode: nil -*- ex: set tabstop=3 expandtab: */ 
+if( !ZT_DEFINED ) { die("Illegal Access"); }
+
 
 /* 
 **  zenTrack Class
@@ -452,7 +454,7 @@
     $query2 .= "user_id IS NULL AND ticket_id = '".$ticket_id."' ";    
    
     // get the lists of recipients and merge them
-    $list = array_merge($this->db_list($query),$this->db_list($query2));
+    $list = $this->mergeArrays($this->db_list($query),$this->db_list($query2));
     // print a debug message
     $this->addDebug("get_notify_recipients","Found ".count($list)
                     ." recipients for ticket $ticket_id",3);
@@ -2068,22 +2070,22 @@
 	$this->add_log($id, $logParams);    
       }
       if( $this->settings["email_closed"] == "on" ) {
-	// send email
-	$recipients = $this->get_notify_recipients($id);
+	     // send email
+	     $recipients = $this->get_notify_recipients($id);
         // make sure the manager gets a notification
         $vals = $this->fetch_bin_role_emails($t['bin_id'],$this->getRoleId('manager'));
         $this->checkIncludedRecipients($recipients,$vals);
         // create email
-	if( is_array($recipients) && count($recipients) ) {
-	  $bin = $t["bin_id"];
-	  $subject = $this->ptrans("Ticket #?: closed",array($id));
-	  $emailParams["Close Time"] = $this->showDateTime($this->currTime);
-	  if( $comments )
-	    $emailParams["body"] = $comments;
-	  $emailParams["tid"] = $t;
-	  $message = $this->formatEmailMessage($emailParams);
-	  $this->sendEmail($recipients,$subject,$message,$user_id);       
-	}
+	     if( is_array($recipients) && count($recipients) ) {
+	       $bin = $t["bin_id"];
+	       $subject = $this->ptrans("Ticket #?: closed",array($id));
+	       $emailParams["Close Time"] = $this->showDateTime($this->currTime);
+	       if( $comments )
+	         $emailParams["body"] = $comments;
+	       $emailParams["tid"] = $t;
+	       $message = $this->formatEmailMessage($emailParams);
+	       $this->sendEmail($recipients,$subject,$message,$user_id);       
+	     }
       } 
     } else if( ($t["tested"] == 1 || $t["approved"] == 1) 
 	       && $t["status"] == "OPEN" ) {
@@ -2094,25 +2096,25 @@
 		      );
       $res = $this->update_ticket($id, $params);
       if( $this->settings["log_pending"] == "on" ) {
-	// make a log entry
-	$logParams = array(
+	     // make a log entry
+	     $logParams = array(
 			   "action"   =>  'PENDING',
 			   "ticket_id" =>  $id,
 			   "entry"    =>  $entry
 			   );
-	if( $user_id ) {
-	  $logParams["user_id"] = $user_id;
-	}
-	$logParams["bin_id"] = $t["bin_id"];      
-	if( $hours )
-	  $logParams["hours"] = $hours;
-	if( $comments )
-	  $logParams["entry"] = $comments;
-	$this->add_log($id, $logParams);    
+	     if( $user_id ) {
+	       $logParams["user_id"] = $user_id;
+	     }
+	     $logParams["bin_id"] = $t["bin_id"];      
+	     if( $hours )
+	       $logParams["hours"] = $hours;
+	     if( $comments )
+	       $logParams["entry"] = $comments;
+	     $this->add_log($id, $logParams);    
       }  
       if( $this->settings["email_pending"] == "on" ) {
-	// send an email
-	$recipients = $this->get_notify_recipients($id);
+  	     // send an email
+	     $recipients = $this->get_notify_recipients($id);
         // make sure the testers/managers gets a notification
         if( $t['tested'] == 1 ) {
           $vals = $this->fetch_bin_role_emails($t['bin_id'], $this->getRoleId('tester'));
@@ -2122,16 +2124,16 @@
         }        
         $this->checkIncludedRecipients($recipients, $vals);
         // create email
-	if( is_array($recipients) && count($recipients) ) {
-	  $bin = $t["bin_id"];
-	  $subject = $this->ptrans("Ticket #?: closed",array($id));
-	  $emailParams["Close Time"] = $this->showDateTime($this->currTime);
-	  if( $comments )
-	    $emailParams["body"] = $this->ffv($comments);
-	  $emailParams["tid"] = $id;
-	  $message = $this->formatEmailMessage($emailParams);
-	  $this->sendEmail($recipients,$subject,$message,$user_id);
-	} 
+	     if( is_array($recipients) && count($recipients) ) {
+	       $bin = $t["bin_id"];
+	       $subject = $this->ptrans("Ticket #?: closed",array($id));
+	       $emailParams["Close Time"] = $this->showDateTime($this->currTime);
+	       if( $comments )
+	         $emailParams["body"] = $this->ffv($comments);
+	       $emailParams["tid"] = $id;
+	       $message = $this->formatEmailMessage($emailParams);
+	       $this->sendEmail($recipients,$subject,$message,$user_id);
+	     } 
       } 
     }
     return($res);
@@ -2166,9 +2168,11 @@
     if( $this->check_status($t,"READY") ) {
       // if ticket is ready to close, then close it
       $params = array(
-            "status"  =>  'CLOSED',
-            "ctime"   =>  $this->currTime
+            "status"  =>  'CLOSED'
             );
+      if( ! $t["ctime"] ) {
+        $params["ctime"]=$this->currTime;
+      }
       if( $this->settings["retain_owner_closed"] != "on") {
         $params["user_id"] = NULL;
       }
@@ -2216,6 +2220,9 @@
       if( $this->settings["retain_owner_pending"] != "on") {
         $params["user_id"] = NULL;
       }
+      if( ! $t["ctime"]  && $this->settings["ctime_on_pending"] == "on" ) {
+        $params["ctime"]=$this->currTime;
+      }
       $res = $this->update_ticket($id, $params);
       if( $this->settings["log_pending"] == "on" ) {
         // make a log entry
@@ -2313,8 +2320,8 @@
       $params["user_id"] = NULL;
     } else {
       $currentOwner=$this->checkNum($t['user_id']);
-      $ownerAccess = $this->get_access($currentOwner,1);
-      if( strlen($ownerAccess["$newBin"]) < 1 ) {
+      $ownerAccess = $this->get_access($currentOwner,0);
+      if( ! (strlen($ownerAccess["$newBin"]) > 0) ) {
         $params["user_id"] = NULL;
       } else {
         if( $ownerAccess["$newBin"] < $this->settings["level_user"] ) {
@@ -2672,10 +2679,13 @@
       $this->set_notify_list($id,$notify_list);
 
       // create a log entry
+      $log_entry=$params["user_id"]?tr("Assigned to [?-?]",array($params["user_id"],$this->formatName($params["user_id"])))
+                                   :tr("Unassigned");
       $lParams = array(
                        "action"   =>   "CREATED",
                        "user_id"   =>   $params["creator_id"],
-                       "bin_id"    =>   $params["bin_id"]
+                       "bin_id"    =>   $params["bin_id"],
+                       "entry"     =>   $log_entry
                        );
       if( $log_notes ) {
         $lParams["entry"] = $log_notes;
@@ -2816,6 +2826,7 @@
                                break;
             case "otime":
             case "ctime":
+            case "deadline":
             case "start_date": $v1=$this->showDateTime($v1);
                                $v2=$this->showDateTime($v2);
             default:           $d1 = "";
@@ -4346,7 +4357,7 @@
       if( $ticket["user_id"] != $user_id ) {
         if( !$c["override"] 
             || ( strlen($access["$bin_id"]) 
-                 && $access["bin_id"] < $this->settings["level_super"] )
+                 && $access["$bin_id"] < $this->settings["level_super"] )
             || ( !strlen($access["$bin_id"]) 
                  && $user["access_level"] < $this->settings["level_super"])
                  ) {
@@ -4455,7 +4466,7 @@
                                 "owner"    => 1,
                                 "access"   => 1,
                                 "status"   => array('OPEN'),
-                                "override" => 0,
+                                "override" => 1,
                                 "egate"    => 1,
                                 "level"    => $this->settings["level_user"]
                                 );
@@ -4575,7 +4586,7 @@
                                "owner"    => 0,
                                "access"   => 1,
                                "status"   => array('PENDING'),
-                               "override" => 0,
+                               "override" => 1,
                                "egate"    => 1,
                                "level"    => $this->settings["level_test"]
                                );
@@ -5520,7 +5531,7 @@
     return $id;
   }
   
-  function get_open_tickets($id,$type) {
+/*   function get_open_tickets($id,$type,$orderby='otime DESC') {
     // get open tickets of a contact
     
     $ids2 = array(); //arry for person ids
@@ -5572,8 +5583,47 @@
     }
     
     return($tickets);
+  } */
+  
+  /**
+   * Returns a list of tickets associated with a given company
+   *
+   * @param int $company_id an id from the zentrack_company.company_id field
+   * @param string $order_by see includes/sorting.php
+   */
+  function getTicketsByCompany($company_id, $sort) {
+    // collect a list of tickets belonging to any contact within the current company
+    // (or simply belonging to the company itself)
+    $id = $this->checkNum($company_id);
+    $query = "SELECT ticket_id FROM ZENTRACK_RELATED_CONTACTS c, ZENTRACK_EMPLOYEE e"
+        ." WHERE (cp_id = '$id' AND c.type='1')"
+        ." OR (c.type='2' AND c.cp_id = e.person_id AND e.company_id = '$id')";
+    $ids = array_unique($this->db_list($query));
+    $this->addDebug("getTicketsByCompany","[".count($ids)."]".$query,3);
+    // skip query if there are no ids to retrieve
+    if( !count($ids) ) { return array(); }
+    // using our list of ids, call the get_tickets method normally 
+    return $this->get_tickets( array('id'=>$ids), $sort );
   }
    
+  /**
+   * Returns a list of tickets associated with a given contact
+   *
+   * @param int $company_id an id from the zentrack_employee.person_id field
+   * @param string $sort see includes/sorting.php
+   */
+  function getTicketsByPerson($person_id, $sort) {
+    // collect a list of tickets matching the current contact
+    $id = $this->checkNum($person_id);
+    $query = "SELECT ticket_id FROM ZENTRACK_RELATED_CONTACTS WHERE cp_id = '".$id."' AND type ='2'";
+    $ids = array_unique($this->db_list($query));
+    $this->addDebug("getTicketsByEmployee","[".count($ids)."]".$query,3);
+    // skip query if there are no ids to retrieve
+    if( !count($ids) ) { return array(); }
+    // using our list of ids, call the get_tickets method normally 
+    return $this->get_tickets( array('id'=>$ids), $sort );
+  }
+
   function get_contact_all() {
     // get all companys for the droplists
     $query = "SELECT company_id,title,office FROM ZENTRACK_COMPANY ORDER BY title asc";
diff -x install/ -Nur zentrack_2-5-5_pre1/install/UPGRADE_mssqlserver.sql zentrack_2-5-5/install/UPGRADE_mssqlserver.sql
--- zentrack_2-5-5_pre1/install/UPGRADE_mssqlserver.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/UPGRADE_mssqlserver.sql	2005-05-01 23:59:39.000000000 -0700
@@ -1,53 +1,29 @@
 
-
 --DROP TABLE ZENTRACK_FIELD_MAP;
 
-
-
 --
-
 -- FIELD MAP WHICH DESCRIBES HOW FIELDS ARE RENDERED IN DIFFERENT VIEWS
-
 --
-
 CREATE TABLE ZENTRACK_FIELD_MAP (
-
    field_map_id NUMERIC(12) NOT NULL,
-
    field_name   VARCHAR(25) NOT NULL,
-
    field_label  VARCHAR(255) default '',
-
    is_visible   NUMERIC(1) default 0,
-
    which_view   VARCHAR(50) default 0,
-
    default_val  VARCHAR(255),
-
    sort_order   NUMERIC(4) default 0,
-
    field_type   VARCHAR(50),
-
    num_cols     NUMERIC(4) default 0,
-
    num_rows     NUMERIC(2) default 0,
-
    is_required  NUMERIC(1) default 0,
-
    PRIMARY KEY (field_map_id)
-
 );
 
-
-
 CREATE INDEX fldmap_sort ON ZENTRACK_FIELD_MAP(sort_order);
-
 CREATE INDEX fldmap_label ON ZENTRACK_FIELD_MAP(field_label);
-
 CREATE INDEX fldmap_both ON ZENTRACK_FIELD_MAP(sort_order,field_label);
 
 
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -311,22 +287,19 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
-
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 -- Modify the version number
-
-UPDATE ZENTRACK_SETTINGS SET value='2.5.0.3' WHERE setting_id=74;
-
-
+UPDATE ZENTRACK_SETTINGS SET value='2.5.5' WHERE setting_id=74;
 
 -- Add new settings
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');A
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
diff -x install/ -Nur zentrack_2-5-5_pre1/install/UPGRADE_mysql.sql zentrack_2-5-5/install/UPGRADE_mysql.sql
--- zentrack_2-5-5_pre1/install/UPGRADE_mysql.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/UPGRADE_mysql.sql	2005-05-01 23:59:39.000000000 -0700
@@ -1,47 +1,25 @@
 --
-
 -- FIELD MAP WHICH DESCRIBES HOW FIELDS ARE RENDERED IN DIFFERENT VIEWS
-
 --
-
 CREATE TABLE ZENTRACK_FIELD_MAP (
-
    field_map_id INT(12) NOT NULL auto_increment,
-
    field_name   VARCHAR(25) NOT NULL,
-
    field_label  VARCHAR(255) default '',
-
    is_visible   INT(1) default 0,
-
    which_view   VARCHAR(50) default 0,
-
    default_val  VARCHAR(255),
-
    sort_order   INT(4) default 0,
-
    field_type   VARCHAR(50),
-
    num_cols     INT(4) default 0,
-
    num_rows     INT(2) default 0,
-
    is_required  INT(1) default 0,
-
    PRIMARY KEY (field_map_id),
-
    INDEX fldmap_sort (sort_order),
-
    INDEX fldmap_label (field_label),
-
    INDEX fldmap_both (sort_order,field_label)
-
 );
 
 
-
-
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -305,24 +283,19 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
-
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 -- Modify the version number
-
-UPDATE ZENTRACK_SETTINGS SET value='2.5.0.3' WHERE setting_id=74;
-
-
+UPDATE ZENTRACK_SETTINGS SET value='2.5.5' WHERE setting_id=74;
 
 -- Add new settings
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
-
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
diff -x install/ -Nur zentrack_2-5-5_pre1/install/UPGRADE_oracle.sql zentrack_2-5-5/install/UPGRADE_oracle.sql
--- zentrack_2-5-5_pre1/install/UPGRADE_oracle.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/UPGRADE_oracle.sql	2005-05-01 23:59:39.000000000 -0700
@@ -1,53 +1,28 @@
 
-
 --
-
 -- FIELD MAP WHICH DESCRIBES HOW FIELDS ARE RENDERED IN DIFFERENT VIEWS
-
 --
-
 CREATE TABLE ZENTRACK_FIELD_MAP (
-
    field_map_id NUMBER(12) CONSTRAINT fldmap_notnull NOT NULL,
-
    field_name   VARCHAR2(25) CONSTRAINT fldmap_nm_notnull NOT NULL,
-
    field_label  VARCHAR2(255) default '',
-
    is_visible   NUMBER(1) default 0,
-
    which_view   VARCHAR2(50) default 0,
-
    default_val  VARCHAR2(255),
-
    sort_order   NUMBER(4) default 0,
-
    field_type   VARCHAR2(50),
-
    num_cols     NUMBER(4) default 0,
-
    num_rows     NUMBER(2) default 0,
-
    is_required  NUMBER(1) default 0,
-
    CONSTRAINT field_map_pk PRIMARY KEY (field_map_id)
-
 );
 
-
-
 CREATE INDEX fldmap_sort ON ZENTRACK_FIELD_MAP(sort_order);
-
 CREATE INDEX fldmap_label ON ZENTRACK_FIELD_MAP(label);
-
 CREATE INDEX fldmap_both ON ZENTRACK_FIELD_MAP(sort_order,label);
 
-
-
 create sequence field_map_id_seq start with 1001 nocache;
 
-
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -311,24 +286,20 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
-
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 -- Modify the version number
 
-UPDATE ZENTRACK_SETTINGS SET value='2.5.0.3' WHERE setting_id=74;
-
-
+UPDATE ZENTRACK_SETTINGS SET value='2.5.5' WHERE setting_id=74;
 
 -- Add new settings
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
-
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
\ No newline at end of file
diff -x install/ -Nur zentrack_2-5-5_pre1/install/UPGRADE_postgres.sql zentrack_2-5-5/install/UPGRADE_postgres.sql
--- zentrack_2-5-5_pre1/install/UPGRADE_postgres.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/UPGRADE_postgres.sql	2005-05-01 23:59:39.000000000 -0700
@@ -1,45 +1,24 @@
 
-
 --
-
 -- FIELD MAP WHICH DESCRIBES HOW FIELDS ARE RENDERED IN DIFFERENT VIEWS
-
 --
 
-
-
 CREATE SEQUENCE "field_map_id_seq" start 1001 increment 1 maxvalue 2147483647 minvalue 1 cache 1;
 
-
-
 CREATE TABLE ZENTRACK_FIELD_MAP (
-
    field_map_id default nextval('"field_map_seq_id"') NOT NULL PRIMARY KEY,
-
    field_name   VARCHAR2(25) NOT NULL default '',
-
    field_label  VARCHAR2(255) default '',
-
    is_visible   NUMBER(1) default 0,
-
    which_view   VARCHAR2(50) default 0,
-
    default_val  VARCHAR2(255),
-
    sort_order   NUMBER(4) default 0,
-
    field_type   VARCHAR2(50),
-
    num_cols     NUMBER(4) default 0,
-
    num_rows     NUMBER(2) default 0,
-
-   is_required  NUMBER(1) default 0,
-
+   is_required  NUMBER(1) default 0
 );
 
-
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -303,22 +282,19 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
-
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 -- Modify the version number
-
-UPDATE ZENTRACK_SETTINGS SET value='2.5.0.3' WHERE setting_id=74;
-
-
+UPDATE ZENTRACK_SETTINGS SET value='2.5.5' WHERE setting_id=74;
 
 -- Add new settings
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
diff -x install/ -Nur zentrack_2-5-5_pre1/install/build_oracle.sql zentrack_2-5-5/install/build_oracle.sql
--- zentrack_2-5-5_pre1/install/build_oracle.sql	2005-02-19 22:58:25.000000000 -0800
+++ zentrack_2-5-5/install/build_oracle.sql	2005-04-20 10:22:42.000000000 -0700
@@ -401,7 +401,7 @@
 
 CREATE TABLE ZENTRACK_GROUP_DETAIL (
   group_id NUMBER(12) CONSTRAINT grp_dtlid_notnull NOT NULL,
-  value varchar2(255),
+  field_value varchar2(255),
   sort_order NUMBER(3)
 );
 
diff -x install/ -Nur zentrack_2-5-5_pre1/install/build_postgres.sql zentrack_2-5-5/install/build_postgres.sql
--- zentrack_2-5-5_pre1/install/build_postgres.sql	2005-02-09 05:56:14.000000000 -0800
+++ zentrack_2-5-5/install/build_postgres.sql	2005-04-20 10:22:42.000000000 -0700
@@ -415,7 +415,7 @@
   eval_type VARCHAR(10) default NULL,
   eval_text TEXT default NULL,
   name_of_file VARCHAR(100),
-  include_none int2,
+  include_none int2
 );
 
 CREATE TABLE ZENTRACK_GROUP_DETAIL (
diff -x install/ -Nur zentrack_2-5-5_pre1/install/configVars.php.default zentrack_2-5-5/install/configVars.php.default
--- zentrack_2-5-5_pre1/install/configVars.php.default	2005-01-30 23:29:21.000000000 -0800
+++ zentrack_2-5-5/install/configVars.php.default	2005-04-13 08:08:14.000000000 -0700
@@ -20,10 +20,10 @@
    global $Db_Instance;
    global $Db_Login;
    global $Db_Pass;
-   
 
    $this->demo_mode = $Demo_Mode; 
-   $this->debug = $Debug_Mode;  
+   $this->debug = $Debug_Mode;
+   //$this->sql_debug = true;  //uncommenting this will break everything and produce tons of garbage
    
    $this->database_type      = $Db_Type;
    $this->database_instance  = $Db_Instance;
diff -x install/ -Nur zentrack_2-5-5_pre1/install/header.php.default zentrack_2-5-5/install/header.php.default
--- zentrack_2-5-5_pre1/install/header.php.default	2005-01-30 23:05:49.000000000 -0800
+++ zentrack_2-5-5/install/header.php.default	2005-05-01 23:59:39.000000000 -0700
@@ -7,22 +7,17 @@
   /* DO NOT PUT ANYTHING, INCLUDING SPACES, OUTSIDE OF THE <? ?> marks */
 
   /*
-  **  T H E S E   T W O   M U S T    B E   S E T ! ! !
+  **  THE INCLUDES DIRECTORY
   **
-  **  OR ZENTRACK WILL NOT RUN PROPERLY
-  **  Don't use trailing slashes
+  **  Use the complete system path from the root directory
+  **  Do not use a trailing slash
+  **  Use only a forward slash "/" since a backslash "\" has special meaning in php.
+  **
+  **  Valid samples:
+  **    $libDir = "c:/private_folder/includes";
+  **    $libDir = "/var/hidden/localhost/zentrack/includes";
   */
-
-  // the directory where zentrack includes are stored
-  // use the complete system path
-  $libDir = "/web/zentrack/includes";
-
-  // the base url used to reach zentrack
-  $rootUrl = "http://www.yourhost.com/zentrack";
-
-  // the directory where the www files are stored
-  $rootWWW = dirname(__FILE__);  //this will work for most installs
-  //$rootWWW = "/web/zentrack/www"; //uncomment if the previous line fails
+  $libDir = "/not_web_directory/zentrack/includes";
 
   /*
   **
@@ -31,7 +26,8 @@
   **  Valid SQL Types:
   **     mysql
   **     mssqlpo
-  **     oci8po (oracle >= 8i)
+  **     odbc_mssql (see below)
+  **     oci8po (see below)
   **     postgres (postgres >= 7)
   **     (see http://phplens.com/lens/adodb/docs-adodb.htm#drivers for more)
   */
@@ -41,30 +37,38 @@
   $Db_Pass      = "test";       //password
   $Db_Host      = "localhost";  //host of database (localhost doesn't work with sqlserver)
 
-   // ORACLE USERS! the order of items may be changed
-   // it may be that the entry will be:
-   //      $Db_Host: "serverip:port#"
-   //      $Db_Login: "scott"
-   //      $Db_Pass:  "tiger"
-   //      $Db_Instance: "servicename"
-   // or:
-   //      $Db_Host: ""
-   //      $Db_Login: "scott"
-   //      $Db_Pass:  "tiger"
-   //      $Db_Instance: "TNSName"
-   // hints for these entries:
-   // - for Oracle 8 and later, use "oci8po" as database_type
-   // - if using an Oracle Names Server, leave database_instance blank and put
-   //   the database alias into database_host
-   // - the same applies if you want to use a whole TNS connection string
-   // - to connect to a local instance, you may leave the database_host blank
-   // also... you may need to uncomment the following for oracle to work properly:
-   //   putenv("ORACLE_SID=ORACLE"); 
-   // the database instance
-   //   putenv("ORACLE_HOME=/opt/oracle/oracle/8.0.3"); 
-   // the oracle installation directory
-   //   putenv("TNS_ADMIN=/opt/oracle/product/8.1.5/network/admin"); 
-   // the directory of the tnsnames.ora file
+  // SQL SERVER >= 2000
+  // Here is a sample config
+  //$Db_Type = "odbc_mssql"; //sql type
+  //$Db_Instance = null; //db name
+  //$Db_Login = "test"; //username
+  //$Db_Pass = "test"; //password
+  //$Db_Host = "Driver={SQL Server};Server=123.321.123.321;Database=Zentrack;";
+
+  // ORACLE USERS! the order of items may be changed
+  // it may be that the entry will be:
+  //      $Db_Host: "serverip:port#"
+  //      $Db_Login: "scott"
+  //      $Db_Pass:  "tiger"
+  //      $Db_Instance: "servicename"
+  // or:
+  //      $Db_Host: ""
+  //      $Db_Login: "scott"
+  //      $Db_Pass:  "tiger"
+  //      $Db_Instance: "TNSName"
+  // hints for these entries:
+  // - for Oracle 8 and later, use "oci8po" as database_type
+  // - if using an Oracle Names Server, leave database_instance blank and put
+  //   the database alias into database_host
+  // - the same applies if you want to use a whole TNS connection string
+  // - to connect to a local instance, you may leave the database_host blank
+  // also... you may need to uncomment the following for oracle to work properly:
+  //   putenv("ORACLE_SID=ORACLE"); 
+  // the database instance
+  //   putenv("ORACLE_HOME=/opt/oracle/oracle/8.0.3"); 
+  // the oracle installation directory
+  //   putenv("TNS_ADMIN=/opt/oracle/product/8.1.5/network/admin"); 
+  // the directory of the tnsnames.ora file
 
   /*
   ** DEMO MODE AND DEBUG OUTPUT 
@@ -82,11 +86,10 @@
   ** setup and then be sure to turn it off.  It provides
   ** information about your system that is not for public
   ** consumption.
-  **
   */
 
   //set this from 0=off, 1=errors, 2=warnings, 3=notices(all)
-  $Debug_Mode = 1;  
+  $Debug_Mode = 0;  
 
   //set this to "on" prevents users from doing anything you don't
   //want them doing on a demo site
@@ -130,10 +133,20 @@
    // setlocale(LC_TIME, "de_DE");  // german
    // setlocale(LC_TIME, "es_ES");  // spanish
 
+  // the base url used to reach zentrack
+  // you should only need to edit this if the auto-config fails
+  $rootUrl = 'http://'.$_SERVER['HTTP_HOST'] . preg_replace( '@^'.str_replace("\\", "/", realpath(strtolower($_SERVER['DOCUMENT_ROOT']))).'@', '', str_replace("\\", "/", realpath(strtolower(dirname(__FILE__)))));
+  //$rootUrl = "http://www.yourhost.com/zentrack"; //uncomment and edit if the previous line fails
+
+  // the directory where the www files are stored
+  // you should only need to edit this if the auto-config fails
+  $rootWWW = dirname(__FILE__);
+  //$rootWWW = "/web/zentrack/www"; //uncomment and edit if the previous line fails
 
   /*
   **  LEAVE THIS PART ALONE
   */
+  define('ZT_DEFINED', true);
   include_once("$libDir/headerInc.php");
   
 }?>
\ No newline at end of file
diff -x install/ -Nur zentrack_2-5-5_pre1/install/seed_mssqlserver.sql zentrack_2-5-5/install/seed_mssqlserver.sql
--- zentrack_2-5-5_pre1/install/seed_mssqlserver.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/seed_mssqlserver.sql	2005-05-03 21:49:25.399884800 -0700
@@ -1,45 +1,24 @@
 
-
 --
-
 -- Load data for table 'ZENTRACK_ACCESS'
-
 --
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (1,2,2,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (2,2,3,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (3,2,3,2,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (4,2,4,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (5,2,3,1,NULL);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_BINS'
-
 --
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (1,'Accounting',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (2,'Engineering',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (3,'Marketing',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (4,'IT',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (5,'Tech Support',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (6,'Human Resources',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (7,'Test Bin',0,0);
 
-
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -107,7 +86,7 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('71','otime','Open Time','1','project_create',NULL,'13','label','20','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('72','ctime','Close Time','0','project_create',NULL,'14','label','20','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('73','bin_id','Bin','1','project_create',NULL,'5','menu','50','1','1');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('74','type_id','Type','0','project_create',NULL,'6','label','50','1','1');
+--INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('74','type_id','Type','0','project_create',NULL,'6','label','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('75','system_id','System','1','project_create',NULL,'7','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('76','user_id','Owner','1','project_create',NULL,'8','searchbox','50','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('78','tested','Testing','0','project_create',NULL,'9','checkbox','1','1','0');
@@ -138,7 +117,7 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('103','otime','Open Time','0','project_edit',NULL,'16','label','20','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('104','ctime','Close Time','0','project_edit',NULL,'17','label','20','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('105','bin_id','Bin','1','project_edit',NULL,'7','menu','50','1','1');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('106','type_id','Type','1','project_edit',NULL,'8','menu','50','1','1');
+--INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('106','type_id','Type','1','project_edit',NULL,'8','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('107','system_id','System','1','project_edit',NULL,'9','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('108','user_id','Owner','1','project_edit',NULL,'10','searchbox','50','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('109','creator_id','Creator','0','project_edit',NULL,'11','label','50','1','1');
@@ -200,7 +179,7 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('166','otime','Open Time','0','project_list',NULL,'15','label','20','1',NULL);
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('167','ctime','Close Time','0','project_list',NULL,'3','label','20','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('168','bin_id','Bin','1','project_list',NULL,'7','label','50','1',NULL);
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('169','type_id','Type','0','project_list',NULL,'8','label','50','1',NULL);
+--INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('169','type_id','Type','0','project_list',NULL,'8','label','50','1',NULL);
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('170','system_id','System','0','project_list',NULL,'9','label','50','1',NULL);
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('171','user_id','Owner','0','project_list',NULL,'10','label','50','1',NULL);
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('172','creator_id','Creator','0','project_list',NULL,'11','label','50','1',NULL);
@@ -303,428 +282,222 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 
 -- Load data for table 'ZENTRACK_LOGS'
-
 --
-
 INSERT INTO ZENTRACK_LOGS (lid, ticket_id, user_id, bin_id, created, action, hours, entry) VALUES (1,2,1,2,1019621210,'ACCEPTED',NULL,NULL);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_PRIORITIES'
-
 --
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (1,'Critical',5,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (2,'High',4,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (3,'Medium',3,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (4,'Low',2,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (6,'None',1,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_SETTINGS'
-
 --
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (1,'admin_email','root@localhost','The email address of the zenTrack administrator');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (2,'bot_name','zenBot','The system bots name');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (3,'allow_cview','on','Allow ticket creator to view the ticket, regardless of access');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (4,'allow_reject','on','Allow tickets to be rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (5,'allow_yank','on','Allow tickets to be yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (6,'allow_assign','on','Allow tickets to be assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (7,'allow_accept','on','Allow tickets to be accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (8,'allow_relate','on','Allow tickets to be related to one another');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (9,'attachment_max_size','20000','The maximum file size of an attachment (in Bytes)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (10,'attachment_text_types','php,txt,pl,cgi,asp,jsp,java,class,inc','Files with this extention will be displayed as text by the browser');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (11,'attachment_types_allowed','txt,html,xls,pdf,jpg,gif,png,doc,wpd,php','Comma seperated list.  Only these extensions may be uploaded.  Set to 0 to allow all (WARNING:  this is a security risk!)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (12,'color_links','#006633','Color of links on the page');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (13,'color_grey','#666666','Greyed text color');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (14,'color_background','#FFFFFF','Color of normal bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (15,'color_text','#000000','Color of normal text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (16,'color_alt_background','#99CCCC','Color of alternate bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (17,'color_alt_text','#000066','Color of alternate text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (18,'color_title_background','#669999','Color of title cell bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (19,'color_title_text','#FFFFFF','Color of title cell text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (20,'color_bars','#EAEAEA','Color of background in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (21,'color_bar_text','#006666','Color of text in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (22,'color_hot','#990000','Color of text when hot(critical/errors)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (23,'color_highlight','#CCFFCC','Color of background to highlight text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (24,'color_hover','#00FF33','Color of links on mouseover (hover)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (25,'default_test_checked','on','Testing required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (26,'default_aprv_checked','off','Approval required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (27,'email_pending','on','Send email to tester/approver when ticket is pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (28,'email_reject','on','Send email to sender/creator when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (29,'email_assign','on','Send email to recipient when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (30,'email_arrival','on','Send email to bin owner when ticket arrives in bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (31,'email_created','on','Send email to bin owner when ticket is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (32,'email_closed','on','Send email to bin owner when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (33,'email_completed','on','Send email to bin owner when ticket is completed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (34,'email_max_logs','40','Maximum logs to send via email.  Set to blank for unlimited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (35,'font_size','12','Font size on pages, in pixels');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (36,'font_face','Arial, Helvetica','Font face to appear on pages, comma seperated list');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (37,'level_create','2','Level required to create a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (38,'level_hot','1','Priority level to consider hot(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (39,'level_highlight','2','Priority level to highlight(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (40,'level_user','2','Level required to perform worker/user tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (41,'level_super','3','Level required to perform supervisor tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (42,'level_settings','5','Level required to edit system settings');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (43,'level_accept','2','Level required to accept a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (44,'level_assign','3','Level required to assign a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (45,'level_yank','3','Level required to yank a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (46,'level_test','3','Level required to test a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (47,'level_approve','3','Level required to approve a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (48,'level_move','2','Level required to move a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (49,'level_view','0','Level required to view a bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (50,'level_edit','3','Level required to edit a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (51,'log_show_bins','on','Display current bin in log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (52,'log_show_time','on','Display time created in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (53,'log_show_user','on','Display creator in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (54,'log_show_att','on','Display attachments in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (55,'log_edit','on','Create a log when ticket is edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (56,'log_assign','on','Create a log when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (57,'log_accept','on','Create a log when ticket is accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (58,'log_relate','on','Create a log when ticket is related');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (59,'log_reject','on','Create a log when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (60,'log_approve','on','Create a log when ticket is approved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (61,'log_close','on','Create a log when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (62,'log_test','on','Create a log when ticket is tested');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (63,'log_move','on','Create a log when ticket is moved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (64,'log_yank','on','Create a log when ticket is yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (65,'log_pending','on','Create a log when status is set to pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (66,'log_attachment','on','Create a log entry when an attachment is added.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (67,'system_name','zenTrack','Name of the zenTrack ticketing system displayed to users');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (68,'url_view_attachment','viewAttachment.php','Link to script which displays attachments in a secure manner (for server integrity), no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (70,'url_view_ticket','ticket.php','Link to script which displays ticket information, no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (71,'allow_pwd_save','off','Allows user to save passphrase (not implemented yet)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (72,'check_pwd_simple','on','System will refuse lazy passwords');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (73,'level_reports','1','Level required to access and view reports');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.0.3','The version of zentrack, this cannot be edited');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.5','The version of zentrack, this cannot be edited');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (75,'date_fmt_long','%A %d, %b %Y','Long date format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (76,'date_fmt_short','%m/%d/%Y','Short Date Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (77,'date_fmt_time','%H:%M','Time Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (78,'time_elapsed_unit','hours','Use hours, days, months, years, seconds, or weeks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (79,'language_default','english','This is the language to display pages in, must match one of the filenames in includes/translations/');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (80,'default_deadline','+1 month','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (81,'default_start_date','+1 day','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (82,'email_interface_enabled','off', 'Use the email gateway');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (83,'default_notify_manager','on','Add bin manager to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (84,'default_notify_tester','on','Add bin tester to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (85,'default_notify_creator','on','Add ticket creator to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (86,'default_notify_owner','on','Add ticket owner to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (87,'sql_cache_time',0,'Number of seconds to cache db results, set to 0 to disable sql caching');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (88,'email_log','on','Send email when a log entry is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (89,'priority_medium','2','Median priority, pick number around 1/2 total priorities, set to 0 to disable coloring');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (90,'color_priority_low','#FFFFFF','Base color for low priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (91,'color_priority_med','#FFFFCC','Base color for medium priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (92,'color_priority_hi','#FF9999','Base color for high priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (93,'log_email','on','Create a log entry when tickets are emailed.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (94,'level_create_proj','2','Access level required to create projects.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (95,'use_euro_date','off','On if using European format(dd/mm/yyyy) instead of american(mm/dd/yyyy)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (96,'level_edit_varfields','2','Access level required to edit fields on the variable fields tab.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (97,'varfield_tab_name', 'Custom', 'Name to appear on the variable fields tab');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (98,'allow_htaccess', 'on', 'If on, will attempt to authenticate users based on apache htaccess (username and password must match ZT)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (99,'allow_contacts', 'on', 'Specify whether contacts will be used or not');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (100,'level_contacts','3','Level required to view the contacts');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (101,'paging_max_rows','20','Number of rows to display at a time');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (102,'retain_owner_move','on','Keep owner data on tickets after a ticket is moved between bins');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after
-
- a ticket is set to PENDING');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after a ticket is set to PENDING');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (104,'retain_owner_closed','on','Keep owner data on tickets after a ticket is set to CLOSED');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (105,'character_set','ISO-8859-15','Character set to be used');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (106,'default_start_date_hours','on','Include hours in default start date for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (107,'default_deadline_hours','on','Include hours in default deadline for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
-
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
 
 --
-
 -- Load data for table 'ZENTRACK_SYSTEMS'
-
 --
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (1,'Apache',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (2,'Email',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (3,'Database',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (4,'Network',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (5,'PC',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (6,'Printer',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (7,'Website',0,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_TASKS'
-
 --
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (1,'Action Taken',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (2,'Debugging',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (3,'Implementation',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (4,'Note',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (5,'Planning',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (6,'Question',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (7,'Research',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (8,'Review',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (9,'Solution',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (10,'Testing',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (11,'Work',0,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_TICKETS'
-
 --
-
 INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (1,'Welcome to zenTrack!!',2,'OPEN','Welcome to the zenTrack system!\r<br />\n\r<br />\nCongratulations, your install was successful.\r<br />\n\r<br />\nYou can find more help in the help section on this site, and online at http://zentrack.phpzen.net.\r<br />\n\r<br />\nYou can find support for your product at the sourceforge project: http://www.sourceforge.net/projects/zentrack',1019621097,NULL,2,5,2,7,1,0,0,NULL,NULL,0.00,NULL,NULL,0.10);
-
 INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (2,'CHANGE ADMIN PASSWORD',1,'OPEN','You need to change the admin passphrase right away.\r<br />\n\r<br />\nIn addition, two other accounts, User, and Guest were created.  You will want to modify those or delete them as your system security and preferences determine.',1019621197,NULL,2,8,NULL,7,1,0,0,NULL,NULL,0.01,1022137200,NULL,1.00);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_TYPES'
-
 --
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (1,'Project',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (2,'Support Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (3,'Bug',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (4,'Enhancement',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (5,'Event Log',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (6,'Feature Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (7,'Service',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (8,'Task',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (9,'Note',0,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_USERS'
-
 --
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (1,'Administrator',5,'7b7bc2512ee1fedcd76bdc68926d4f7b','Administrator','zenTrack','ADMIN','root@localhost','This is the master login',2,2);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (2,'Guest',0,'adb831a7fdd83dd1e2a309ce7591dff8','Visitor','Guest','GUEST',NULL,NULL,2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (3,'User',3,'8f9bfe9d1345237cb3b2b205864da075','User','Default','USER',NULL,'Default User Account',2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (4,'egate',2,NULL,'Gateway','Email','egate','zentrack@localhost','Email Gateway Account',1,0);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_VARFIELD_IDX'
-
 --
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu1', 'Custom Menu 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu2', 'Custom Menu 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string1', 'Custom String 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string2', 'Custom String 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number1', 'Custom Number 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number2', 'Custom Number 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean1', 'Custom Boolean 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean2', 'Custom Boolean 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date1', 'Custom Date 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date2', 'Custom Date 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_text1', 'Custom Text 1', 1         );
 
 
-
-
-
 -- CREATE AN ENTRY FOR EACH EXISTING TICKET IN THE VARFIELDS TABLE
-
 INSERT INTO ZENTRACK_VARFIELD (ticket_id) SELECT id FROM ZENTRACK_TICKETS;
 
-
diff -x install/ -Nur zentrack_2-5-5_pre1/install/seed_mysql.sql zentrack_2-5-5/install/seed_mysql.sql
--- zentrack_2-5-5_pre1/install/seed_mysql.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/seed_mysql.sql	2005-05-03 21:48:35.818590400 -0700
@@ -1,49 +1,26 @@
 
-
 --
-
 -- Load data for table 'ZENTRACK_ACCESS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (1,2,2,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (2,2,3,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (3,2,3,2,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (4,2,4,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (5,2,3,1,NULL);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_BINS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (1,'Accounting',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (2,'Engineering',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (3,'Marketing',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (4,'IT',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (5,'Tech Support',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (6,'Human Resources',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (7,'Test Bin',0,0);
 
-
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -307,448 +284,232 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
-
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 -- Load data for table 'ZENTRACK_LOGS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_LOGS (lid, ticket_id, user_id, bin_id, created, action, hours, entry) VALUES (1,2,1,2,1019621210,'ACCEPTED',NULL,NULL);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_PRIORITIES'
-
 --
 
-
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (1,'Critical',5,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (2,'High',4,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (3,'Medium',3,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (4,'Low',2,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (6,'None',1,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_SETTINGS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (1,'admin_email','root@localhost','The email address of the zenTrack administrator');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (2,'bot_name','zenBot','The system bots name');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (3,'allow_cview','on','Allow ticket creator to view the ticket, regardless of access');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (4,'allow_reject','on','Allow tickets to be rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (5,'allow_yank','on','Allow tickets to be yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (6,'allow_assign','on','Allow tickets to be assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (7,'allow_accept','on','Allow tickets to be accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (8,'allow_relate','on','Allow tickets to be related to one another');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (9,'attachment_max_size','20000','The maximum file size of an attachment (in Bytes)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (10,'attachment_text_types','php,txt,pl,cgi,asp,jsp,java,class,inc','Files with this extention will be displayed as text by the browser');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (11,'attachment_types_allowed','txt,html,xls,pdf,jpg,gif,png,doc,wpd,php','Comma seperated list.  Only these extensions may be uploaded.  Set to 0 to allow all (WARNING:  this is a security risk!)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (12,'color_links','#006633','Color of links on the page');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (13,'color_grey','#666666','Greyed text color');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (14,'color_background','#FFFFFF','Color of normal bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (15,'color_text','#000000','Color of normal text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (16,'color_alt_background','#99CCCC','Color of alternate bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (17,'color_alt_text','#000066','Color of alternate text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (18,'color_title_background','#669999','Color of title cell bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (19,'color_title_text','#FFFFFF','Color of title cell text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (20,'color_bars','#EAEAEA','Color of background in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (21,'color_bar_text','#006666','Color of text in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (22,'color_hot','#990000','Color of text when hot(critical/errors)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (23,'color_highlight','#CCFFCC','Color of background to highlight text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (24,'color_hover','#00FF33','Color of links on mouseover (hover)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (25,'default_test_checked','on','Testing required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (26,'default_aprv_checked','off','Approval required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (27,'email_pending','on','Send email to tester/approver when ticket is pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (28,'email_reject','on','Send email to sender/creator when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (29,'email_assign','on','Send email to recipient when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (30,'email_arrival','on','Send email to bin owner when ticket arrives in bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (31,'email_created','on','Send email to bin owner when ticket is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (32,'email_closed','on','Send email to bin owner when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (33,'email_completed','on','Send email to bin owner when ticket is completed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (34,'email_max_logs','40','Maximum logs to send via email.  Set to blank for unlimited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (35,'font_size','12','Font size on pages, in pixels');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (36,'font_face','Arial, Helvetica','Font face to appear on pages, comma seperated list');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (37,'level_create','2','Level required to create a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (38,'level_hot','1','Priority level to consider hot(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (39,'level_highlight','2','Priority level to highlight(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (40,'level_user','2','Level required to perform worker/user tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (41,'level_super','3','Level required to perform supervisor tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (42,'level_settings','5','Level required to edit system settings');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (43,'level_accept','2','Level required to accept a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (44,'level_assign','3','Level required to assign a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (45,'level_yank','3','Level required to yank a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (46,'level_test','3','Level required to test a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (47,'level_approve','3','Level required to approve a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (48,'level_move','2','Level required to move a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (49,'level_view','0','Level required to view a bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (50,'level_edit','3','Level required to edit a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (51,'log_show_bins','on','Display current bin in log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (52,'log_show_time','on','Display time created in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (53,'log_show_user','on','Display creator in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (54,'log_show_att','on','Display attachments in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (55,'log_edit','on','Create a log when ticket is edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (56,'log_assign','on','Create a log when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (57,'log_accept','on','Create a log when ticket is accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (58,'log_relate','on','Create a log when ticket is related');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (59,'log_reject','on','Create a log when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (60,'log_approve','on','Create a log when ticket is approved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (61,'log_close','on','Create a log when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (62,'log_test','on','Create a log when ticket is tested');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (63,'log_move','on','Create a log when ticket is moved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (64,'log_yank','on','Create a log when ticket is yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (65,'log_pending','on','Create a log when status is set to pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (66,'log_attachment','on','Create a log entry when an attachment is added.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (67,'system_name','zenTrack','Name of the zenTrack ticketing system displayed to users');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (68,'url_view_attachment','viewAttachment.php','Link to script which displays attachments in a secure manner (for server integrity), no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (70,'url_view_ticket','ticket.php','Link to script which displays ticket information, no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (71,'allow_pwd_save','off','Allows user to save passphrase (not implemented yet)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (72,'check_pwd_simple','on','System will refuse lazy passwords');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (73,'level_reports','1','Level required to access and view reports');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.0.3','The version of zentrack, this cannot be edited');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.5','The version of zentrack, this cannot be edited');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (75,'date_fmt_long','%A %d, %b %Y','Long date format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (76,'date_fmt_short','%m/%d/%Y','Short Date Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (77,'date_fmt_time','%H:%M','Time Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (78,'time_elapsed_unit','hours','Use hours, days, months, years, seconds, or weeks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (79,'language_default','english','This is the language to display pages in, must match one of the filenames in includes/translations/');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (80,'default_deadline','+1 month','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (81,'default_start_date','+1 day','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (82,'email_interface_enabled','off', 'Use the email gateway');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (83,'default_notify_manager','on','Add bin manager to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (84,'default_notify_tester','on','Add bin tester to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (85,'default_notify_creator','on','Add ticket creator to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (86,'default_notify_owner','on','Add ticket owner to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (87,'sql_cache_time',0,'Number of seconds to cache db results, set to 0 to disable sql caching');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (88,'email_log','on','Send email when a log entry is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (89,'priority_medium','2','Median priority, pick number around 1/2 total priorities, set to 0 to disable coloring');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (90,'color_priority_low','#FFFFFF','Base color for low priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (91,'color_priority_med','#FFFFCC','Base color for medium priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (92,'color_priority_hi','#FF9999','Base color for high priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (93,'log_email','on','Create a log entry when tickets are emailed.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (94,'level_create_proj','2','Access level required to create projects.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (95,'use_euro_date','off','On if using European format(dd/mm/yyyy) instead of american(mm/dd/yyyy)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (96,'level_edit_varfields','2','Access level required to edit fields on the "custom" tab.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (97,'varfield_tab_name', 'Custom', 'Name to appear on the variable fields tab');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (98,'allow_htaccess', 'on', 'If on, will attempt to authenticate users based on apache htaccess (username and password must match ZT)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (99,'allow_contacts', 'on', 'Specify whether contacts will be used or not');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (100,'level_contacts','3','Level required to view the contacts');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (101,'paging_max_rows','20','Number of rows to display at a time');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (102,'retain_owner_move','on','Keep owner data on tickets after a ticket is moved between bins');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after a ticket is set to PENDING');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (104,'retain_owner_closed','on','Keep owner data on tickets after a ticket is set to CLOSED');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (105,'character_set','ISO-8859-15','Character set to be used');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (106,'default_start_date_hours','on','Include hours in default start date for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (107,'default_deadline_hours','on','Include hours in default deadline for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
-
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
 
 --
-
 -- Load data for table 'ZENTRACK_SYSTEMS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (1,'Apache',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (2,'Email',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (3,'Database',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (4,'Network',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (5,'PC',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (6,'Printer',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (7,'Website',0,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_TASKS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (1,'Action Taken',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (2,'Debugging',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (3,'Implementation',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (4,'Note',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (5,'Planning',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (6,'Question',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (7,'Research',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (8,'Review',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (9,'Solution',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (10,'Testing',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (11,'Work',0,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_TICKETS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (1,'Welcome to zenTrack!!',2,'OPEN','Welcome to the zenTrack system!\r<br />\n\r<br />\nCongratulations, your install was successful.\r<br />\n\r<br />\nYou can find more help in the help section on this site, and online at http://zentrack.phpzen.net.\r<br />\n\r<br />\nYou can find support for your product at the sourceforge project: http://www.sourceforge.net/projects/zentrack',1019621097,NULL,2,5,2,7,1,0,0,NULL,NULL,0.00,NULL,NULL,0.10);
-
 INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (2,'CHANGE ADMIN PASSWORD',1,'OPEN','You need to change the admin passphrase right away.\r<br />\n\r<br />\nIn addition, two other accounts, User, and Guest were created.  You will want to modify those or delete them as your system security and preferences determine.',1019621197,NULL,2,8,NULL,7,1,0,0,NULL,NULL,0.01,1022137200,NULL,1.00);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_TYPES'
-
 --
 
-
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (1,'Project',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (2,'Support Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (3,'Bug',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (4,'Enhancement',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (5,'Event Log',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (6,'Feature Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (7,'Service',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (8,'Task',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (9,'Note',0,1);
 
-
-
 --
-
 -- Load data for table 'ZENTRACK_USERS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (1,'Administrator',5,'7b7bc2512ee1fedcd76bdc68926d4f7b','Administrator','zenTrack','ADMIN','root@localhost','This is the master login',2,2);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (2,'Guest',0,'adb831a7fdd83dd1e2a309ce7591dff8','Visitor','Guest','GUEST',NULL,NULL,2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (3,'User',3,'8f9bfe9d1345237cb3b2b205864da075','User','Default','USER',NULL,'Default User Account',2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (4,'egate',2,NULL,'Gateway','Email','egate','zentrack@localhost','Email Gateway Account',1,0);
 
 
-
-
-
 --
-
 -- Load data for table 'ZENTRACK_VARFIELD_IDX'
-
 --
 
 
-
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu1', 'Custom Menu 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu2', 'Custom Menu 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string1', 'Custom String 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string2', 'Custom String 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number1', 'Custom Number 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number2', 'Custom Number 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean1', 'Custom Boolean 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean2', 'Custom Boolean 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date1', 'Custom Date 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date2', 'Custom Date 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_text1', 'Custom Text 1', 1         );
 
 
 
-
-
-
-
 /* CREATE AN ENTRY FOR EACH EXISTING TICKET IN THE VARFIELDS TABLE */
-
 INSERT INTO ZENTRACK_VARFIELD (ticket_id) SELECT id FROM ZENTRACK_TICKETS;
diff -x install/ -Nur zentrack_2-5-5_pre1/install/seed_oracle.sql zentrack_2-5-5/install/seed_oracle.sql
--- zentrack_2-5-5_pre1/install/seed_oracle.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/seed_oracle.sql	2005-05-03 21:48:46.994660800 -0700
@@ -1,43 +1,24 @@
 --
-
 -- Dumping data for table 'ZENTRACK_ACCESS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (1,2,2,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (2,2,3,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (3,2,3,2,NULL);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_BINS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (1,'Accounting',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (2,'Engineering',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (3,'Marketing',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (4,'IT',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (5,'Tech Support',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (6,'Human Resources',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (7,'Test Bin',0,0);
 
 
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -301,452 +282,234 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 
 -- Dumping data for table 'ZENTRACK_LOGS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_LOGS (lid, ticket_id, user_id, bin_id, created, action, hours, entry) VALUES (1,2,1,2,1019621210,'ACCEPTED',NULL,NULL);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_PRIORITIES'
-
 --
 
-
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (1,'Critical',5,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (2,'High',4,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (3,'Medium',3,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (4,'Low',2,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (6,'None',1,1);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_SETTINGS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (1,'admin_email','root@localhost','The email address of the zenTrack administrator');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (2,'bot_name','zenBot','The system bots name');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (3,'allow_cview','on','Allow ticket creator to view the ticket, regardless of access');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (4,'allow_reject','on','Allow tickets to be rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (5,'allow_yank','on','Allow tickets to be yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (6,'allow_assign','on','Allow tickets to be assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (7,'allow_accept','on','Allow tickets to be accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (8,'allow_relate','on','Allow tickets to be related to one another');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (9,'attachment_max_size','20000','The maximum file size of an attachment (in Bytes)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (10,'attachment_text_types','php,txt,pl,cgi,asp,jsp,java,class,inc','Files with this extention will be displayed as text by the browser');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (11,'attachment_types_allowed','txt,html,xls,pdf,jpg,gif,png,doc,wpd,php','Comma seperated list.  Only these extensions may be uploaded.  Set to 0 to allow all (WARNING:  this is a security risk!)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (12,'color_links','#006633','Color of links on the page');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (13,'color_grey','#666666','Greyed text color');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (14,'color_background','#FFFFFF','Color of normal bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (15,'color_text','#000000','Color of normal text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (16,'color_alt_background','#99CCCC','Color of alternate bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (17,'color_alt_text','#000066','Color of alternate text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (18,'color_title_background','#669999','Color of title cell bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (19,'color_title_text','#FFFFFF','Color of title cell text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (20,'color_bars','#EAEAEA','Color of background in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (21,'color_bar_text','#006666','Color of text in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (22,'color_hot','#990000','Color of text when hot(critical/errors)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (23,'color_highlight','#CCFFCC','Color of background to highlight text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (24,'color_hover','#00FF33','Color of links on mouseover (hover)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (25,'default_test_checked','on','Testing required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (26,'default_aprv_checked','off','Approval required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (27,'email_pending','on','Send email to tester/approver when ticket is pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (28,'email_reject','on','Send email to sender/creator when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (29,'email_assign','on','Send email to recipient when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (30,'email_arrival','on','Send email to bin owner when ticket arrives in bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (31,'email_created','on','Send email to bin owner when ticket is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (32,'email_closed','on','Send email to bin owner when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (33,'email_completed','on','Send email to bin owner when ticket is completed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (34,'email_max_logs','40','Maximum logs to send via email.  Set to blank for unlimited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (35,'font_size','12','Font size on pages, in pixels');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (36,'font_face','Arial, Helvetica','Font face to appear on pages, comma seperated list');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (37,'level_create','2','Level required to create a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (38,'level_hot','1','Priority level to consider hot(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (39,'level_highlight','2','Priority level to highlight(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (40,'level_user','2','Level required to perform worker/user tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (41,'level_super','3','Level required to perform supervisor tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (42,'level_settings','5','Level required to edit system settings');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (43,'level_accept','2','Level required to accept a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (44,'level_assign','3','Level required to assign a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (45,'level_yank','3','Level required to yank a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (46,'level_test','3','Level required to test a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (47,'level_approve','3','Level required to approve a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (48,'level_move','2','Level required to move a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (49,'level_view','0','Level required to view a bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (50,'level_edit','3','Level required to edit a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (51,'log_show_bins','on','Display current bin in log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (52,'log_show_time','on','Display time created in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (53,'log_show_user','on','Display creator in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (54,'log_show_att','on','Display attachments in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (55,'log_edit','on','Create a log when ticket is edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (56,'log_assign','on','Create a log when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (57,'log_accept','on','Create a log when ticket is accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (58,'log_relate','on','Create a log when ticket is related');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (59,'log_reject','on','Create a log when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (60,'log_approve','on','Create a log when ticket is approved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (61,'log_close','on','Create a log when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (62,'log_test','on','Create a log when ticket is tested');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (63,'log_move','on','Create a log when ticket is moved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (64,'log_yank','on','Create a log when ticket is yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (65,'log_pending','on','Create a log when status is set to pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (66,'log_attachment','on','Create a log entry when an attachment is added.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (67,'system_name','zenTrack','Name of the zenTrack ticketing system displayed to users');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (68,'url_view_attachment','viewAttachment.php','Link to script which displays attachments in a secure manner (for server integrity), no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (69,'url_view_log','viewLog.php','Link to script which displays an individual log entry, no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (70,'url_view_ticket','ticket.php','Link to script which displays ticket information, no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (71,'allow_pwd_save','off','Allows users to save passphrase in a cookie(fairly secure/not available until v2.1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (72,'check_pwd_simple','on','System will refuse lazy passwords');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (73,'level_reports','1','Level required to access and view reports');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.0.3','The version of zentrack, this cannot be edited');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.5','The version of zentrack, this cannot be edited');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (75,'date_fmt_long','%A %d, %b %Y','Long date format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (76,'date_fmt_short','%m/%d/%Y','Short Date Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (77,'date_fmt_time','%H:%M','Time Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (78,'time_elapsed_unit','hours','Use hours, days, months, years, seconds, or weeks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (79,'language_default','english','This is the language to display pages in, must match one of the filenames in includes/translations/');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (80,'default_deadline','+1 month','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (81,'default_start_date','+1 day','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (82,'email_interface_enabled','off', 'Use the email gateway');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (83,'default_notify_manager','on','Add bin manager to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (84,'default_notify_tester','on','Add bin tester to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (85,'default_notify_creator','on','Add ticket creator to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (86,'default_notify_owner','on','Add ticket owner to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (87,'sql_cache_time',0,'Number of seconds to cache db results, set to 0 to disable sql caching');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (88,'email_log','on','Send email when a log entry is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (89,'priority_medium','2','Median priority, pick number around 1/2 total priorities, set to 0 to disable coloring');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (90,'color_priority_low','#FFFFFF','Base color for low priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (91,'color_priority_med','#FFFFCC','Base color for medium priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (92,'color_priority_hi','#FF9999','Base color for high priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (93,'log_email','on','Create a log entry when tickets are emailed.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (94,'level_create_proj','2','Access level required to create projects.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (95,'use_euro_date','off','On if using European format(dd/mm/yyyy) instead of american(mm/dd/yyyy)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (96,'level_edit_varfields','2','Access level required to edit fields on the "custom" tab.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (97,'varfield_tab_name', 'Custom', 'Name to appear on the variable fields tab');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (98,'allow_htaccess', 'on', 'If on, will attempt to authenticate users based on apache htaccess (username and password must match ZT)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (99,'allow_contacts', 'on', 'Specify whether contacts will be used or not');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (100,'level_contacts','3','Level required to view the contacts');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (101,'paging_max_rows','20','Number of rows to display at a time');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (102,'retain_owner_move','on','Keep owner data on tickets after a ticket is moved between bins');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after
-
- a ticket is set to PENDING');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after a ticket is set to PENDING');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (104,'retain_owner_closed','on','Keep owner data on tickets after a ticket is set to CLOSED');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (105,'character_set','ISO-8859-15','Character set to be used');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (106,'default_start_date_hours','on','Include hours in default start date for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (107,'default_deadline_hours','on','Include hours in default deadline for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
-
-
-
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
 
 
 
 --
-
 -- Dumping data for table 'ZENTRACK_SYSTEMS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (1,'Apache',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (2,'Email',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (3,'Database',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (4,'Network',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (5,'PC',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (6,'Printer',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (7,'Website',0,1);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_TASKS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (1,'Action Taken',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (2,'Debugging',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (3,'Implementation',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (4,'Note',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (5,'Planning',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (6,'Question',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (7,'Research',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (8,'Review',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (9,'Solution',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (10,'Testing',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (11,'Work',0,1);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_TICKETS'
-
 --
 
-
-
-INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (1,'Welcome to zenTrack!!',2,'OPEN','Welcome to the zenTrack system!\r<br />\n\r<br />\nCongratulations, your install was successful.\r<br />\n\r<br />\nYou can find more help in the help section on this site, and online at http://zentrack.phpzen.net.\r<br />\n\r<br />\nYou can find support for your product at the sourceforge project: http://www.sourceforge.net/projects/zentrack',1019621097,NULL,2,5,NULL,7,1,0,0,NULL,NULL,0.00,NULL,NULL,0.00);
-
+INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_ate, wkd_hours) VALUES (1,'Welcome to zenTrack!!',2,'OPEN','Welcome to the zenTrack system!\r<br />\n\r<br />\nCongratulations, your install was successful.\r<br />\n\r<br />\nYou can find more help in the help section on this site, and online at http://zentrack.phpzen.net.\r<br />\n\r<br />\nYou can find support for your product at the sourceforge project: http://www.sourceforge.net/projects/zentrack',1019621097,NULL,2,5,NULL,7,1,0,0,NULL,NULL,0.00,NULL,NULL,0.00);
 INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (2,'CHANGE ADMIN PASSWORD',1,'OPEN','You need to change the admin passphrase right away.\r<br />\n\r<br />\nIn addition, two other accounts, User, and Guest were created.  You will want to modify those or delete them as your system security and preferences determine.',1019621197,NULL,2,8,1,7,1,1,0,NULL,NULL,0.01,1022137200,NULL,0.00);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_TYPES'
-
 --
 
-
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (1,'Project',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (2,'Support Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (3,'Bug',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (4,'Enhancement',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (5,'Event Log',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (6,'Feature Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (7,'Service',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (8,'Task',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (9,'Note',0,1);
 
-
-
 --
-
 -- Dumping data for table 'ZENTRACK_USERS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (1,'Administrator',5,'7b7bc2512ee1fedcd76bdc68926d4f7b','Administrator','zenTrack','ADMIN','root@localhost','This is the master login',2,2);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (2,'Guest',0,'adb831a7fdd83dd1e2a309ce7591dff8','Visitor','Guest','GUEST',NULL,NULL,2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (3,'User',3,'8f9bfe9d1345237cb3b2b205864da075','User','Default','USER',NULL,'Default User Account',2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (4,'egate',2,NULL,'Gateway','Email','egate','zentrack@localhost','Email Gateway Account',1,0);
 
 
-
-
-
 --
-
 -- Dumping for table 'ZENTRACK_VARFIELD_IDX'
-
 --
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu1', 'Custom Menu 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu2', 'Custom Menu 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string1', 'Custom String 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string2', 'Custom String 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number1', 'Custom Number 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number2', 'Custom Number 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean1', 'Custom Boolean 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean2', 'Custom Boolean 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date1', 'Custom Date 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date2', 'Custom Date 2', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_text1', 'Custom Text 1', 1         );
 
 
-
-
-
 -- CREATE AN ENTRY FOR EACH EXISTING TICKET IN THE VARFIELDS TABLE
-
 INSERT INTO ZENTRACK_VARFIELD (ticket_id) SELECT id FROM ZENTRACK_TICKETS;
diff -x install/ -Nur zentrack_2-5-5_pre1/install/seed_postgres.sql zentrack_2-5-5/install/seed_postgres.sql
--- zentrack_2-5-5_pre1/install/seed_postgres.sql	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/install/seed_postgres.sql	2005-05-03 21:49:16.747443200 -0700
@@ -1,43 +1,23 @@
 --
-
 -- Loading data for table 'ZENTRACK_ACCESS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (1,2,2,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (2,2,3,1,NULL);
-
 INSERT INTO ZENTRACK_ACCESS (access_id, user_id, bin_id, lvl, notes) VALUES (3,2,3,2,NULL);
 
-
-
 --
-
 -- Loading data for table 'ZENTRACK_BINS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (1,'Accounting',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (2,'Engineering',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (3,'Marketing',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (4,'IT',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (5,'Tech Support',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (6,'Human Resources',0,1);
-
 INSERT INTO ZENTRACK_BINS (bid, name, priority, active) VALUES (7,'Test Bin',0,0);
 
-
-
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('2','title','Title','1','ticket_create',NULL,'2','text','200','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('3','priority','Priority','1','ticket_create',NULL,'4','menu','50','1','1');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('5','description','Description','1','ticket_create',NULL,'24','text','60','10','1');
@@ -301,464 +281,240 @@
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('271','custom_string1',NULL,'0','ticket_close',NULL,'21','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('272','custom_string2',NULL,'0','ticket_close',NULL,'22','text','200','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('273','custom_text1',NULL,'0','ticket_close',NULL,'23','text','50','4','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('274','custom_number1',NULL,'0','ticket_close','0','24','text','10','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('275','custom_number2',NULL,'0','ticket_close','0','25','text','10','1','0');
-INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','1');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('276','custom_boolean1',NULL,'0','ticket_close',NULL,'26','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('277','custom_boolean2',NULL,'0','ticket_close',NULL,'27','checkbox','1','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('278','custom_menu1',NULL,'0','ticket_close',NULL,'28','menu','100','1','0');
 INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('279','custom_menu2',NULL,'0','ticket_close',NULL,'29','menu','100','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('280','hours','Hours','1','ticket_close',NULL,'30','text','6','1','0');
+INSERT INTO ZENTRACK_FIELD_MAP (field_map_id,field_name,field_label,is_visible,which_view,default_val,sort_order,field_type,num_cols,num_rows,is_required) VALUES('281','comments','Comments','1','ticket_close',NULL,'31','text','60','10','1');
 
 
 -- Loading data for table 'ZENTRACK_LOGS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_LOGS (lid, ticket_id, user_id, bin_id, created, action, hours, entry) VALUES (1,2,1,2,1019621210,'ACCEPTED',NULL,NULL);
 
-
-
 --
-
 -- Loading data for table 'ZENTRACK_PRIORITIES'
-
 --
 
-
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (1,'Critical',5,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (2,'High',4,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (3,'Medium',3,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (4,'Low',2,1);
-
 INSERT INTO ZENTRACK_PRIORITIES (pid, name, priority, active) VALUES (6,'None',1,1);
 
-
-
 --
-
 -- Loading data for table 'ZENTRACK_SETTINGS'
-
 --
 
-
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (1,'admin_email','root@localhost','The email address of the zenTrack administrator');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (2,'bot_name','zenBot','The system bots name');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (3,'allow_cview','on','Allow ticket creator to view the ticket, regardless of access');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (4,'allow_reject','on','Allow tickets to be rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (5,'allow_yank','on','Allow tickets to be yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (6,'allow_assign','on','Allow tickets to be assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (7,'allow_accept','on','Allow tickets to be accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (8,'allow_relate','on','Allow tickets to be related to one another');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (9,'attachment_max_size','20000','The maximum file size of an attachment (in Bytes)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (10,'attachment_text_types','php,txt,pl,cgi,asp,jsp,java,class,inc','Files with this extention will be displayed as text by the browser');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (11,'attachment_types_allowed','txt,html,xls,pdf,jpg,gif,png,doc,wpd,php','Comma seperated list.  Only these extensions may be uploaded.  Set to 0 to allow all (WARNING:  this is a security risk!)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (12,'color_links','#006633','Color of links on the page');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (13,'color_grey','#666666','Greyed text color');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (14,'color_background','#FFFFFF','Color of normal bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (15,'color_text','#000000','Color of normal text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (16,'color_alt_background','#99CCCC','Color of alternate bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (17,'color_alt_text','#000066','Color of alternate text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (18,'color_title_background','#669999','Color of title cell bg');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (19,'color_title_text','#FFFFFF','Color of title cell text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (20,'color_bars','#EAEAEA','Color of background in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (21,'color_bar_text','#006666','Color of text in rows of data');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (22,'color_hot','#990000','Color of text when hot(critical/errors)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (23,'color_highlight','#CCFFCC','Color of background to highlight text');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (24,'color_hover','#00FF33','Color of links on mouseover (hover)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (25,'default_test_checked','on','Testing required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (26,'default_aprv_checked','off','Approval required defaults to yes');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (27,'email_pending','on','Send email to tester/approver when ticket is pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (28,'email_reject','on','Send email to sender/creator when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (29,'email_assign','on','Send email to recipient when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (30,'email_arrival','on','Send email to bin owner when ticket arrives in bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (31,'email_created','on','Send email to bin owner when ticket is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (32,'email_closed','on','Send email to bin owner when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (33,'email_completed','on','Send email to bin owner when ticket is completed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (34,'email_max_logs','40','Maximum logs to send via email.  Set to blank for unlimited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (35,'font_size','12','Font size on pages, in pixels');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (36,'font_face','Arial, Helvetica','Font face to appear on pages, comma seperated list');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (37,'level_create','2','Level required to create a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (38,'level_hot','1','Priority level to consider hot(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (39,'level_highlight','2','Priority level to highlight(highest is 1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (40,'level_user','2','Level required to perform worker/user tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (41,'level_super','3','Level required to perform supervisor tasks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (42,'level_settings','5','Level required to edit system settings');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (43,'level_accept','2','Level required to accept a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (44,'level_assign','3','Level required to assign a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (45,'level_yank','3','Level required to yank a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (46,'level_test','3','Level required to test a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (47,'level_approve','3','Level required to approve a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (48,'level_move','2','Level required to move a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (49,'level_view','0','Level required to view a bin');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (50,'level_edit','3','Level required to edit a ticket');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (51,'log_show_bins','on','Display current bin in log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (52,'log_show_time','on','Display time created in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (53,'log_show_user','on','Display creator in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (54,'log_show_att','on','Display attachments in the log view');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (55,'log_edit','on','Create a log when ticket is edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (56,'log_assign','on','Create a log when ticket is assigned');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (57,'log_accept','on','Create a log when ticket is accepted');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (58,'log_relate','on','Create a log when ticket is related');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (59,'log_reject','on','Create a log when ticket is rejected');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (60,'log_approve','on','Create a log when ticket is approved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (61,'log_close','on','Create a log when ticket is closed');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (62,'log_test','on','Create a log when ticket is tested');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (63,'log_move','on','Create a log when ticket is moved');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (64,'log_yank','on','Create a log when ticket is yanked');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (65,'log_pending','on','Create a log when status is set to pending');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (66,'log_attachment','on','Create a log entry when an attachment is added.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (67,'system_name','zenTrack','Name of the zenTrack ticketing system displayed to users');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (68,'url_view_attachment','viewAttachment.php','Link to script which displays attachments in a secure manner (for server integrity), no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (70,'url_view_ticket','ticket.php','Link to script which displays ticket information, no leading slash');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (71,'allow_pwd_save','off','Allows users to save passphrase in a cookie(fairly secure/not available until v2.1)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (72,'check_pwd_simple','on','System will refuse lazy passwords');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (73,'level_reports','1','Level required to access and view reports');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.0.3','The version of zentrack, this cannot be edited');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (74,'version_xx','2.5.5','The version of zentrack, this cannot be edited');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (75,'date_fmt_long','%A %d, %b %Y','Long date format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (76,'date_fmt_short','%m/%d/%Y','Short Date Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (77,'date_fmt_time','%H:%M','Time Format');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (78,'time_elapsed_unit','hours','Use hours, days, months, years, seconds, or weeks');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (79,'language_default','english','This is the language to display pages in, must match one of the filenames in includes/translations/');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (80,'default_deadline','+1 month','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (81,'default_start_date','+1 day','Format: [+-]nn [minutes|hours|days|weeks|months], or use 0 for none');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (82,'email_interface_enabled','off', 'Use the email gateway');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (83,'default_notify_manager','on','Add bin manager to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (84,'default_notify_tester','on','Add bin tester to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (85,'default_notify_creator','on','Add ticket creator to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (86,'default_notify_owner','on','Add ticket owner to notify list by default.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (87,'sql_cache_time',0,'Number of seconds to cache db results, set to 0 to disable sql caching');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (88,'email_log','on','Send email when a log entry is created');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (89,'priority_medium','2','Median priority, pick number around 1/2 total priorities, set to 0 to disable coloring');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (90,'color_priority_low','#FFFFFF','Base color for low priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (91,'color_priority_med','#FFFFCC','Base color for medium priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (92,'color_priority_hi','#FF9999','Base color for high priority items');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (93,'log_email','on','Create a log entry when tickets are emailed.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (94,'level_create_proj','2','Access level required to create projects.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (95,'use_euro_date','off','On if using European format(dd/mm/yyyy) instead of american(mm/dd/yyyy)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (96,'level_edit_varfields','2','Access level required to edit fields on the "custom" tab.');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (97,'varfield_tab_name', 'Custom', 'Name to appear on the variable fields tab');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (98,'allow_htaccess', 'on', 'If on, will attempt to authenticate users based on apache htaccess (username and password must match ZT)');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (99,'allow_contacts', 'on', 'Specify whether contacts will be used or not');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (100,'level_contacts','3','Level required to view the contacts');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (101,'paging_max_rows','20','Number of rows to display at a time');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (102,'retain_owner_move','on','Keep owner data on tickets after a ticket is moved between bins');
-
-INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after
-
- a ticket is set to PENDING');
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (103,'retain_owner_pending','on','Keep owner data on tickets after a ticket is set to PENDING');
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (104,'retain_owner_closed','on','Keep owner data on tickets after a ticket is set to CLOSED');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (105,'character_set','ISO-8859-15','Character set to be used');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (106,'default_start_date_hours','on','Include hours in default start date for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (107,'default_deadline_hours','on','Include hours in default deadline for new tickets');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (108,'edit_reason_required', 'off', 'Show a mandatory edit field to explain why the ticket is being edited');
-
 INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (109,'email_accept', 'on', 'Send email to users in the notify list when ticket is accepted');
-
-
-
-
+INSERT INTO ZENTRACK_SETTINGS (setting_id, name, value, description) VALUES (110, 'ctime_on_pending', 'off', 'Set this to on if you want tickets to set ctime when changed to pending');
 
 
 
 ---
-
 --- Loading data for table 'ZENTRACK_SYSTEMS'
-
 ---
 
-
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (1,'Apache',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (2,'Email',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (3,'Database',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (4,'Network',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (5,'PC',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (6,'Printer',0,1);
-
 INSERT INTO ZENTRACK_SYSTEMS (sid, name, priority, active) VALUES (7,'Website',0,1);
 
-
-
 ---
-
 --- Loading data for table 'ZENTRACK_TASKS'
-
 ---
 
-
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (1,'Action Taken',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (2,'Debugging',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (3,'Implementation',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (4,'Note',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (5,'Planning',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (6,'Question',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (7,'Research',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (8,'Review',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (9,'Solution',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (10,'Testing',0,1);
-
 INSERT INTO ZENTRACK_TASKS (task_id, name, priority, active) VALUES (11,'Work',0,1);
 
-
-
 ---
-
 --- Loading data for table 'ZENTRACK_TICKETS'
-
 ---
 
-
-
-INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (1,'Welcome to zenTrack!!',2,'OPEN','Welcome to the zenTrack system!\r<br />\n\r<br />\nCongratulations, your install was successful.\r<br />\n\r<br />\nYou can find more help in the help section on this site, and online at http://zentrack.phpzen.net.\r<br />\n\r<br />\nYou can find support for your product at the sourceforge project: http://www.sourceforge.net/projects/zentrack',1019621097,NULL,2,5,NULL,7,1,0,0,NULL,NULL,0.00,NULL,NULL,0.00);
-
+INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, st_hours, deadline, start_date, wkd_hours) VALUES (1,'Welcome to zenTrack!!',2,'OPEN','Welcome to the zenTrack system!\r<br />\n\r<br />\nCongratulations, your install was successful.\r<br />\n\r<br />\nYou can find more help in the help section on this site, and online at http://zentrack.phpzen.net.\r<br />\n\r<br />\nYou can find support for your product at the sourceforge project: http://www.sourceforge.net/projects/zentrack',1019621097,NULL,2,5,NULL,7,1,0,0,NULL,NULL,0.00,NULL,NULL,0.00);
 INSERT INTO ZENTRACK_TICKETS (id, title, priority, status, description, otime, ctime, bin_id, type_id, user_id, system_id, creator_id, tested, approved, relations, project_id, est_hours, deadline, start_date, wkd_hours) VALUES (2,'CHANGE ADMIN PASSWORD',1,'OPEN','You need to change the admin passphrase right away.\r<br />\n\r<br />\nIn addition, two other accounts, User, and Guest were created.  You will want to modify those or delete them as your system security and preferences determine.',1019621197,NULL,2,8,1,7,1,1,0,NULL,NULL,0.01,1022137200,NULL,0.00);
 
-
-
 ---
-
 --- Loading data for table 'ZENTRACK_TYPES'
-
 ---
 
-
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (1,'Project',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (2,'Support Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (3,'Bug',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (4,'Enhancement',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (5,'Event Log',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (6,'Feature Request',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (7,'Service',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (8,'Task',0,1);
-
 INSERT INTO ZENTRACK_TYPES (type_id, name, priority, active) VALUES (9,'Note',0,1);
 
-
-
 ---
-
 --- Loading data for table 'ZENTRACK_USERS'
-
 ---
 
-
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (1,'Administrator',5,'7b7bc2512ee1fedcd76bdc68926d4f7b','Administrator','zenTrack','ADMIN','root@localhost','This is the master login',2,2);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (2,'Guest',0,'adb831a7fdd83dd1e2a309ce7591dff8','Visitor','Guest','GUEST',NULL,NULL,2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (3,'User',3,'8f9bfe9d1345237cb3b2b205864da075','User','Default','USER',NULL,'Default User Account',2,1);
-
 INSERT INTO ZENTRACK_USERS (user_id, login, access_level, passphrase, lname, fname, initials, email, notes, homebin, active) VALUES (4,'egate',2,NULL,'Gateway','Email','egate','zentrack@havenshade.com','Email Gateway Account',1,0);
 
-
-
 ---
-
 --- Loading data for table 'ZENTRACK_VARFIELD'
-
 ---
 
-
-
 INSERT INTO ZENTRACK_VARFIELD (ticket_id) SELECT id FROM ZENTRACK_TICKETS;
 
-
-
 ---
-
 --- Loading data for table 'ZENTRACK_VARFIELD_IDX'
-
 ---
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu1', 'Custom Menu 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_menu2', 'Custom Menu 2', 1         );
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string1', 'Custom String 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_string2', 'Custom String 2', 1         );
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number1', 'Custom Number 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_number2', 'Custom Number 2', 1         );
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean1', 'Custom Boolean 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_boolean2', 'Custom Boolean 2', 1         );
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date1', 'Custom Date 1', 1         );
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_date2', 'Custom Date 2', 1         );
 
-
-
 INSERT INTO ZENTRACK_VARFIELD_IDX (field_name,       field_label,       sort_order) 
-
                            VALUES ('custom_text1', 'Custom Text 1', 1         );
 
-
diff -x install/ -Nur zentrack_2-5-5_pre1/install/utils/send_test_email.php zentrack_2-5-5/install/utils/send_test_email.php
--- zentrack_2-5-5_pre1/install/utils/send_test_email.php	1969-12-31 16:00:00.000000000 -0800
+++ zentrack_2-5-5/install/utils/send_test_email.php	2005-04-25 05:44:12.000000000 -0700
@@ -0,0 +1,15 @@
+<?
+
+  $to_address = "your@email.com";
+  
+  print "Preparing to deliver email.<br>\n";
+  if( 
+  mail($to_address, "test email settings", "If you receive this email, your php.ini settings are working")
+  ) {
+    print "Email appears to have been delivered correctly, check your inbox.<br>\n";
+  }
+  else {
+    print "Email may not have been delivered correctly.<br>\n";
+  }
+
+?>
\ No newline at end of file
diff -x install/ -Nur zentrack_2-5-5_pre1/www/actions/close.php zentrack_2-5-5/www/actions/close.php
--- zentrack_2-5-5_pre1/www/actions/close.php	2005-03-10 19:16:29.000000000 -0800
+++ zentrack_2-5-5/www/actions/close.php	2005-05-01 23:59:39.000000000 -0700
@@ -21,40 +21,9 @@
     if (!isset($hours)) $hours=0;
     if (!isset($comments)) $comments="";
 
-    $customFieldsArray = false;
-    $customFieldsArray = $map->getFieldMap('ticket_close');
-
-    $fields = array();
-
-    $required = array();
-    foreach($customFieldsArray as $f=>$field) {
-      if( $field['is_required'] ) {
-        $required[] = $f;
-      }
-    }
-    // check for required fields
-    foreach($required as $r) {
-      if( !strlen($$r) ) {
-        $errs[] = tr("Required field missing:") . " " . ucfirst($r);
-      }
-    }
-    // parse variable fields which appear in close ticket screen,
-    // store them in $varfield_params
-    // insure that all requirements are met before proceeding
-    // with the ticket save process
-    if( !$errs ) {
-      foreach(array_keys($customFieldsArray) as $f) {
-        if (strncmp($f,"custom_",7)!=0) {
-          if ( strcmp($f,"hours")!=0 && strcmp($f,"comments")!=0 && strcmp($f,"id")!=0 )  {
-            $fields["$f"]=$customFieldsArray["$f"];
-          }
-          unset($customFieldsArray["$f"]);
-        }
-      }
-      if( $customFieldsArray && count($customFieldsArray) ) {
-        include("$libDir/parseVarfields.php");
-      }
-    }
+    $view = 'ticket_close';
+    include("$libDir/validateFields.php");
+    
     if( !$errs ) {
       if( $zen->inProjectTypeIDs($ticket["type_id"]) ) {
         $children = $zen->getProjectChildren($id,'id,type,status');
@@ -68,28 +37,25 @@
       }
     }
     if( !$errs ) {
-      // create an array of existing fields
-      // to be used for the ticket
-      foreach(array_keys($fields) as $f) {
-        if( strlen($$f) ) {
-          $params["$f"] = $$f;
-        }
-      }
+     $params = array();
+     // create an array of existing fields
+     foreach(array_keys($fields) as $f) {
+       $params["$f"] = $$f;
+     }
+
       $res = $zen->close_ticket($id, $login_id, $hours, $comments);
       if( !$res ) {
         $errs[] = tr("Could not close ticket."). " ".$zen->db_error;
-      } else {
-        if( $customFieldsArray && count($varfield_params) ) {
+      } else if( $varfields && count($varfield_params) ) {
         // update the variable field entries for this ticket
-          $res = $zen->updateVarfieldVals($id, $varfield_params);
-          if( !$res ) {
-            add_system_mesages(tr("? ? closed, but variable fields could not be saved", array(tr('Ticket'),$id)));
-          } else {
-            add_system_messages(tr("Ticket ? has been closed", array($id)));
-          }
+        $res = $zen->updateVarfieldVals($id, $varfield_params);
+        if( !$res ) {
+          add_system_mesages(tr("? ? closed, but variable fields could not be saved", array(tr('Ticket'),$id)));
+        } else {
+          add_system_messages(tr("Ticket ? has been closed", array($id)));
         }
-        $setmode="details";
       }
+      $setmode="details";
     }
     if( $errs ) {
       add_system_messages( $errs, 'Error' );
diff -x install/ -Nur zentrack_2-5-5_pre1/www/actions/email.php zentrack_2-5-5/www/actions/email.php
--- zentrack_2-5-5_pre1/www/actions/email.php	2004-10-12 22:49:08.000000000 -0700
+++ zentrack_2-5-5/www/actions/email.php	2005-03-21 09:55:55.000000000 -0800
@@ -73,7 +73,13 @@
            // Generate log entry with list of email addresses
            $entry = "Ticket emailed to ";
            foreach ($recipients as $v) {
-             $entry .= $v . ", ";
+             if ($zen->checkNum($v) >0) {
+               $user_info=$zen->get_user($v);
+               $v1="[".$v." - ".$user_info["email"]."]";
+             } else {
+               $v1=$v;
+             }
+             $entry .= $v1 . ", ";
            }
            $entry = substr($entry, 0, -2);
            $logParams["entry"] = $entry;
diff -x install/ -Nur zentrack_2-5-5_pre1/www/addProjectSubmit.php zentrack_2-5-5/www/addProjectSubmit.php
--- zentrack_2-5-5_pre1/www/addProjectSubmit.php	2005-02-28 12:02:31.000000000 -0800
+++ zentrack_2-5-5/www/addProjectSubmit.php	2005-05-01 23:59:39.000000000 -0700
@@ -18,6 +18,8 @@
   
   $page_title = tr("Commit New Project");
   $expand_projects = 1;
+  $page_type = "project";
+  $view = 'project_create';
   
   // initiate default values
   $otime = time();  // set time ticket opened
@@ -31,31 +33,8 @@
   $type_id = $zen->projectTypeID();
   $description = nl2br($zen->ffv($description));
   
-  $fields = array(
-  "title"       => "text",
-  "priority"    => "int",
-  "description" => "ignore",
-  "otime"       => "int",
-  "bin_id"       => "int",
-  "type_id"      => "int",
-  "user_id"      => "int",
-  "system_id"    => "int",
-  "tested"      => "int",
-  "approved"    => "int",
-  "relations"   => "text",
-  "project_id"   => "int",
-  "est_hours"   => "num",
-  "deadline"    => "int",
-  "start_date"  => "int"
-  );
-  
-  $fields = $map->getFieldMap('project_create');
-  $required = array();
-  foreach($fields as $f=>$field) {
-    if( $field['is_required'] ) {
-      $required[] = $f;
-    }
-  }
+  include("$libDir/validateFields.php");
+  
   $zen->cleanInput($fields);
   // check for required fields
   foreach($required as $r) {
@@ -78,19 +57,7 @@
       $errs[] = tr("Could not create project.") . " " .$zen->db_error;
     }
     else {
-      // parse variable fields which appear in new ticket screen, 
-      // store them in $varfield_params
-      // insure that all requirements are met before proceeding
-      // with the ticket save process
-      $customFieldsArray = false;
-      if( !$errs ) {
-        $customFieldsArray = $zen->getCustomFields(0, 'Project', 'New');
-        if( $customFieldsArray && count($customFieldsArray) ) {
-          include("$libDir/parseVarfields.php");
-        }
-      }
-      
-      if( $customFieldsArray && count($varfield_params) ) {
+      if( $varfields && count($varfield_params) ) {
         $res = $zen->updateVarfieldVals($id, $varfield_params, $login_id, $bin_id);
         if( !$res ) {
           $errs[] = tr("? created, but variable fields could not be saved", array(tr('Project')));
@@ -108,7 +75,7 @@
     include("$libDir/nav.php");
     $zen->print_errors($errs);
     $view = "project_create";
-    include("$templateDir/newProjectForm.php");
+    include("$templateDir/newTicketForm.php");
     include("$libDir/footer.php");
   }
 ?>
diff -x install/ -Nur zentrack_2-5-5_pre1/www/addSubmit.php zentrack_2-5-5/www/addSubmit.php
--- zentrack_2-5-5_pre1/www/addSubmit.php	2005-03-01 07:32:25.000000000 -0800
+++ zentrack_2-5-5/www/addSubmit.php	2005-05-01 23:59:39.000000000 -0700
@@ -17,6 +17,9 @@
     exit;
   }
   
+  $page_type = 'ticket';
+  $view = 'ticket_create';
+  
   $page_title = tr("Commit New Ticket");
   $expand_tickets = 1;
   
@@ -30,66 +33,8 @@
   }
   
   $description = $zen->ffv($description);
-  
-  $fields = array(
-  "title"       => "text",
-  "priority"    => "int",
-  "description" => "ignore",
-  "otime"       => "int",
-  "bin_id"       => "int",
-  "type_id"      => "int",
-  "user_id"      => "int",
-  "system_id"    => "int",
-  "tested"      => "int",
-  "approved"    => "int",
-  "relations"   => "text",
-  "project_id"   => "int",
-  "est_hours"   => "num",
-  "deadline"    => "int",
-  "start_date"  => "int"
-  );
 
-  $customFieldsArray = false;
-  $customFieldsArray = $map->getFieldMap($type=='project'?'project_create':'ticket_create');
-
-  $required = array();
-  foreach($customFieldsArray as $f=>$field) {
-    if( $field['is_required'] ) {
-      $required[] = $f;
-    }
-  }
-
-  // $required = array(
-  // "title",
-  // "priority",
-  // "description",
-  // "bin_id",
-  // "type_id",
-  // "system_id"
-  // );
-  $zen->cleanInput($fields);
-  
-  // check for required fields
-  foreach($required as $r) {
-    if( !strlen($$r) ) {
-      $errs[] = tr("Required field missing:") . " " . ucfirst($r);
-    }
-  }
-  
-  // parse variable fields which appear in new ticket screen, 
-  // store them in $varfield_params
-  // insure that all requirements are met before proceeding
-  // with the ticket save process
-  if( !$errs ) {
-    foreach(array_keys($customFieldsArray) as $f) {
-      if (strncmp($f,"custom_",7)!=0) {
-        unset($customFieldsArray["$f"]);
-      }
-    }
-    if( $customFieldsArray && count($customFieldsArray) ) {
-      include("$libDir/parseVarfields.php");
-    }
-  }
+  include("$libDir/validateFields.php");
   
   if( !$errs ) {
     // create an array of existing fields
@@ -105,7 +50,7 @@
     $id = $zen->add_ticket($params);
     
     // update the variable field entries for this ticket
-    if( $id && $customFieldsArray && count($varfield_params) ) {
+    if( $id && $varfields && count($varfield_params) ) {
       $res = $zen->updateVarfieldVals($id, $varfield_params);
       if( !$res ) {
         $errs[] = tr("? created, but variable fields could not be saved", array(tr('Ticket')));
diff -x install/ -Nur zentrack_2-5-5_pre1/www/admin/admin_header.php zentrack_2-5-5/www/admin/admin_header.php
--- zentrack_2-5-5_pre1/www/admin/admin_header.php	2005-02-09 05:56:15.000000000 -0800
+++ zentrack_2-5-5/www/admin/admin_header.php	2005-03-31 15:25:39.000000000 -0800
@@ -7,7 +7,7 @@
   $page_title = tr("Administration");
 
   $system_name = $zen->settings["system_name"];
-  if( $login_level < $zen->settings["level_settings"] ) {
+  if( $zen->checkNum($login_level) < $zen->settings["level_settings"] ) {
      $page_title = "Access Error";    
      $msg = "<p class='hot'>" . tr("You do not have access to administrate zenTrack.") . "</p>\n"; 
      include("$libDir/nav.php");     
diff -x install/ -Nur zentrack_2-5-5_pre1/www/assignedProjects.php zentrack_2-5-5/www/assignedProjects.php
--- zentrack_2-5-5_pre1/www/assignedProjects.php	2005-02-09 05:56:15.000000000 -0800
+++ zentrack_2-5-5/www/assignedProjects.php	2005-05-01 23:59:39.000000000 -0700
@@ -9,6 +9,8 @@
   include("header.php");
 
   $page_type = "project";
+  $view = 'project_list';
+
   $params = array(
 		  "type_id"  => $zen->projectTypeIDs(),
 		  "status"  => array("OPEN","PENDING"),
@@ -22,6 +24,7 @@
   $expand_projects = 1;
   include("$libDir/nav.php");
 
+  
   if( $login_bin ) {
     $params["bin_id"] = $login_bin;
   } else {
@@ -29,6 +32,7 @@
   }
   if( is_array($params) )
     $tickets = $zen->get_tickets($params);
+    
   include("$templateDir/listTickets.php");
 
   include("$libDir/footer.php");
diff -x install/ -Nur zentrack_2-5-5_pre1/www/behavior_js.php zentrack_2-5-5/www/behavior_js.php
--- zentrack_2-5-5_pre1/www/behavior_js.php	2005-03-09 09:49:08.000000000 -0800
+++ zentrack_2-5-5/www/behavior_js.php	2005-04-13 09:11:44.000000000 -0700
@@ -397,6 +397,7 @@
     var f = 'window.document.'+fieldObj.form.getAttribute('name');
     var fn = f+'.'+fieldObj.name
     var s = unescape(group.evalText);
+    s = s.replace( /\{form\}.\{field\}/ig, "{field}" );
     s = s.replace( /{form}/ig, f);
     var vals = evalJsString( s.replace(/{field}/ig, fn) );
 
@@ -427,6 +428,29 @@
   }
   behaviorDebug(3, "(setFormValsUsingGroup)updating "+fieldObj.name
 		+" using "+group.name+"["+fieldObj.type+"] with setid="+setid+" and values=["+v+"]");
+  // To be used for hidden, text, etc: set the oldPos value if the fieldObj.value is in the list
+  // (unless we do it, the first element of the list will always be assigned to the field, no matter if the fieldObj.value is in the list)
+  var oldPos = -1;
+  if ( fieldObj.value != null && typeof fieldObj.value != "undef" ) {
+    for(var i=0; i < fields.length && oldPos == -1; i++) {
+      if ( fields[i].value == fieldObj.value ) {
+        oldPos=i;
+      }
+    }
+  }
+  if ( oldPos == -1) {
+    for(var i=0; i < fields.length && oldPos == -1; i++) {
+      if (fields[i].label == fieldObj.value) {
+        oldPos=i;
+      }
+    }
+  }
+  if ( oldPos == -1) {
+    oldPos=0;
+    behaviorDebug(3, "(setFormValsUsingGroup)Did not recognize field value for "+fieldObj.name+" ("+fieldObj.value+")");
+  } else {
+    behaviorDebug(3, "(setFormValsUsingGroup)Recognized field value for "+fieldObj.name+" as ["+fields[oldPos].value+"]"+fields[oldPos].label);
+  }
   switch( fieldObj.type ) {
     case "checkbox":
       if( fields[0].value ) {
@@ -434,11 +458,15 @@
       }
       break;
     case "hidden":
+      var labelText = document.getElementById(fieldObj.name+"LabelText");
+      if( labelText ) {
+        labelText.innerHTML = fields[oldPos].label;
+      }
     case "button":
     case "submit":
     case "text":
     case "textarea":
-      fieldObj.value = fields[0].value;
+      fieldObj.value = fields[oldPos].value;
       break;
     case "select":
     case "select-one":
@@ -446,7 +474,9 @@
       if( fieldObj.selectedIndex && fieldObj.options && fieldObj.options.length > 0 ) {
         // store the currently selected value and try to reproduce in a minute
         var oldValue = fieldObj.options[ fieldObj.selectedIndex ].value;
+        behaviorDebug(3, "(setFormValsUsingGroup)storing oldValue="+oldValue);
       }
+      behaviorDebug(3, "(setFormValsUsingGroup)storing oldValue="+oldValue); 
       fieldObj.length = 0;
       for(var i=0; i < fields.length; i++) {
         var f = fields[i];
@@ -456,7 +486,8 @@
         fieldObj.options[i].value = f.value;
         // try to set to the same value if possible
         if( f.value == oldValue ) {
-          fieldObj.options[i].selected = true;
+//          fieldObj.options[i].selected = true;
+          fieldObj.selectedIndex=i;
         }
       }
       break;
diff -x install/ -Nur zentrack_2-5-5_pre1/www/contact.php zentrack_2-5-5/www/contact.php
--- zentrack_2-5-5_pre1/www/contact.php	2004-09-02 10:24:19.000000000 -0700
+++ zentrack_2-5-5/www/contact.php	2005-04-25 05:44:12.000000000 -0700
@@ -61,12 +61,16 @@
       if($pid){
 	    	include("$templateDir/contact_personBox.php"); 
 	    	if($overview=="tickets") {
-		    	//show open tickets
-					$tickets = $zen->get_open_tickets($id,"2");
+          //collect field map info
+          $view = 'ticket_list';
+          $fields = $map->getFieldMap($view);
+		    	//sort tickets
+          include("$libDir/sorting.php");
+          // collect open tickets
+          $tickets = $zen->getTicketsByPerson($id, join(',',$orderby));
+					//$tickets = $zen->get_open_tickets($id,"2");
 					
-					if ($tickets) {
-						include("$templateDir/listTickets.php");
-					}
+          include("$templateDir/listTickets.php");
 	    	}
 	    	
       } else {
@@ -82,13 +86,16 @@
 	  				include("$templateDir/agreement_list.php");
   				}
 				} elseif ($overview=="tickets") {
+          //collect field map info
+          $view = 'ticket_list';
+          $fields = $map->getFieldMap($view);
+          // sort tickets
+          include("$libDir/sorting.php");
 					//show open tickets
-					$tickets = $zen->get_open_tickets($id,"1");
-					
+					//$tickets = $zen->get_open_tickets($id,"1");
+          $tickets = $zen->getTicketsByCompany($id,join(',',$orderby));
 					echo "<br>";
-					if ($tickets) {
-						include("$templateDir/listTickets.php");
-					}
+          include("$templateDir/listTickets.php");
 				} else {
 					//show the related contacts
 					$parms = array(1 => array(1 => "company_id", 2 => "=", 3 => $id),
diff -x install/ -Nur zentrack_2-5-5_pre1/www/header.php zentrack_2-5-5/www/header.php
--- zentrack_2-5-5_pre1/www/header.php	2005-05-04 06:28:27.510040000 -0700
+++ zentrack_2-5-5/www/header.php	2005-05-03 21:46:58.869184000 -0700
@@ -7,22 +7,17 @@
   /* DO NOT PUT ANYTHING, INCLUDING SPACES, OUTSIDE OF THE <? ?> marks */
 
   /*
-  **  T H E S E   T W O   M U S T    B E   S E T ! ! !
+  **  THE INCLUDES DIRECTORY
   **
-  **  OR ZENTRACK WILL NOT RUN PROPERLY
-  **  Don't use trailing slashes
+  **  Use the complete system path from the root directory
+  **  Do not use a trailing slash
+  **  Use only a forward slash "/" since a backslash "\" has special meaning in php.
+  **
+  **  Valid samples:
+  **    $libDir = "c:/private_folder/includes";
+  **    $libDir = "/var/hidden/localhost/zentrack/includes";
   */
-
-  // the directory where zentrack includes are stored
-  // use the complete system path
-  $libDir = "/web/zentrack/includes";
-
-  // the base url used to reach zentrack
-  $rootUrl = "http://www.yourhost.com/zentrack";
-
-  // the directory where the www files are stored
-  $rootWWW = dirname(__FILE__);  //this will work for most installs
-  //$rootWWW = "/web/zentrack/www"; //uncomment if the previous line fails
+  $libDir = "/not_web_directory/zentrack/includes";
 
   /*
   **
@@ -31,7 +26,8 @@
   **  Valid SQL Types:
   **     mysql
   **     mssqlpo
-  **     oci8po (oracle >= 8i)
+  **     odbc_mssql (see below)
+  **     oci8po (see below)
   **     postgres (postgres >= 7)
   **     (see http://phplens.com/lens/adodb/docs-adodb.htm#drivers for more)
   */
@@ -41,30 +37,38 @@
   $Db_Pass      = "test";       //password
   $Db_Host      = "localhost";  //host of database (localhost doesn't work with sqlserver)
 
-   // ORACLE USERS! the order of items may be changed
-   // it may be that the entry will be:
-   //      $Db_Host: "serverip:port#"
-   //      $Db_Login: "scott"
-   //      $Db_Pass:  "tiger"
-   //      $Db_Instance: "servicename"
-   // or:
-   //      $Db_Host: ""
-   //      $Db_Login: "scott"
-   //      $Db_Pass:  "tiger"
-   //      $Db_Instance: "TNSName"
-   // hints for these entries:
-   // - for Oracle 8 and later, use "oci8po" as database_type
-   // - if using an Oracle Names Server, leave database_instance blank and put
-   //   the database alias into database_host
-   // - the same applies if you want to use a whole TNS connection string
-   // - to connect to a local instance, you may leave the database_host blank
-   // also... you may need to uncomment the following for oracle to work properly:
-   //   putenv("ORACLE_SID=ORACLE"); 
-   // the database instance
-   //   putenv("ORACLE_HOME=/opt/oracle/oracle/8.0.3"); 
-   // the oracle installation directory
-   //   putenv("TNS_ADMIN=/opt/oracle/product/8.1.5/network/admin"); 
-   // the directory of the tnsnames.ora file
+  // SQL SERVER >= 2000
+  // Here is a sample config
+  //$Db_Type = "odbc_mssql"; //sql type
+  //$Db_Instance = null; //db name
+  //$Db_Login = "test"; //username
+  //$Db_Pass = "test"; //password
+  //$Db_Host = "Driver={SQL Server};Server=123.321.123.321;Database=Zentrack;";
+
+  // ORACLE USERS! the order of items may be changed
+  // it may be that the entry will be:
+  //      $Db_Host: "serverip:port#"
+  //      $Db_Login: "scott"
+  //      $Db_Pass:  "tiger"
+  //      $Db_Instance: "servicename"
+  // or:
+  //      $Db_Host: ""
+  //      $Db_Login: "scott"
+  //      $Db_Pass:  "tiger"
+  //      $Db_Instance: "TNSName"
+  // hints for these entries:
+  // - for Oracle 8 and later, use "oci8po" as database_type
+  // - if using an Oracle Names Server, leave database_instance blank and put
+  //   the database alias into database_host
+  // - the same applies if you want to use a whole TNS connection string
+  // - to connect to a local instance, you may leave the database_host blank
+  // also... you may need to uncomment the following for oracle to work properly:
+  //   putenv("ORACLE_SID=ORACLE"); 
+  // the database instance
+  //   putenv("ORACLE_HOME=/opt/oracle/oracle/8.0.3"); 
+  // the oracle installation directory
+  //   putenv("TNS_ADMIN=/opt/oracle/product/8.1.5/network/admin"); 
+  // the directory of the tnsnames.ora file
 
   /*
   ** DEMO MODE AND DEBUG OUTPUT 
@@ -82,11 +86,10 @@
   ** setup and then be sure to turn it off.  It provides
   ** information about your system that is not for public
   ** consumption.
-  **
   */
 
   //set this from 0=off, 1=errors, 2=warnings, 3=notices(all)
-  $Debug_Mode = 1;  
+  $Debug_Mode = 0;  
 
   //set this to "on" prevents users from doing anything you don't
   //want them doing on a demo site
@@ -130,10 +133,20 @@
    // setlocale(LC_TIME, "de_DE");  // german
    // setlocale(LC_TIME, "es_ES");  // spanish
 
+  // the base url used to reach zentrack
+  // you should only need to edit this if the auto-config fails
+  $rootUrl = 'http://'.$_SERVER['HTTP_HOST'] . preg_replace( '@^'.str_replace("\\", "/", realpath(strtolower($_SERVER['DOCUMENT_ROOT']))).'@', '', str_replace("\\", "/", realpath(strtolower(dirname(__FILE__)))));
+  //$rootUrl = "http://www.yourhost.com/zentrack"; //uncomment and edit if the previous line fails
+
+  // the directory where the www files are stored
+  // you should only need to edit this if the auto-config fails
+  $rootWWW = dirname(__FILE__);
+  //$rootWWW = "/web/zentrack/www"; //uncomment and edit if the previous line fails
 
   /*
   **  LEAVE THIS PART ALONE
   */
+  define('ZT_DEFINED', true);
   include_once("$libDir/headerInc.php");
   
 }?>
\ No newline at end of file
diff -x install/ -Nur zentrack_2-5-5_pre1/www/javascript.js zentrack_2-5-5/www/javascript.js
--- zentrack_2-5-5_pre1/www/javascript.js	2005-03-11 07:37:39.000000000 -0800
+++ zentrack_2-5-5/www/javascript.js	2005-04-13 08:08:16.000000000 -0700
@@ -46,7 +46,7 @@
 	src.style.cursor = 'hand'; 
 	src.style.backgroundColor = clrOver;
 	if( txtOver != null &&  txtOver != "" ){
-	  if( src.children ) {
+	  if( src.children && src.children.tags('A') && src.children.tags('A')[0] ) {
 	    src.children.tags('A')[0].style.color = txtOver;
 	  }
 	}
@@ -56,7 +56,7 @@
   src.style.cursor = 'default'; 
   src.style.backgroundColor = clrIn; 
   if( txtIn != null && txtIn != "" ){
-    if( src.children ) {
+    if( src.children && src.children.tags('A') && src.children.tags('A')[0] ) {
       src.children.tags('A')[0].style.color = txtIn;
     }
   }
